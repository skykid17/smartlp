##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##
[symantec:dlp:syslog]
KV_MODE = auto_escaped
pulldown_type = true
category = Network & Security
description = Symantec Data Loss Protection system events
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-symantec_dlp_alert_severity_extraction = symantec_dlp_alert_severity_extraction
REPORT-symantec_dlp_dvc_extraction = symantec_dlp_dvc_extraction
REPORT-symantec_dlp_key_value_extraction = symantec_dlp_kv_extraction

EVAL-blocked = if(blocked == "" or blocked == "N/A", null, blocked)
EVAL-incident_id = if(incident_id == "" or incident_id == "N/A", null, incident_id)
EVAL-incident_snapshot = if(incident_snapshot == "" or incident_snapshot == "N/A", null, incident_snapshot)
EVAL-match_count = if(match_count == "" or match_count == "N/A", null, match_count)
EVAL-protocol = if(protocol == "" or protocol == "N/A", null, protocol)
EVAL-policy = if(policy == "" or policy == "N/A", null, policy)
EVAL-rules = if(rules == "" or rules == "N/A", null, rules)
EVAL-sender = if(sender == "" or sender == "N/A", null, sender)
EVAL-subject = if(subject == "" or subject == "N/A", null, subject)
EVAL-file_name = if(file_name == "" or file_name == "N/A", null, file_name)
EVAL-parent_path = if(parent_path == "" or parent_path == "N/A", null, parent_path)
EVAL-path = if(path == "" or path == "N/A", null, path)
EVAL-quarantine_parent_path = if(quarantine_parent_path == "" or quarantine_parent_path == "N/A", null, quarantine_parent_path)
EVAL-scan = if(scan == "" or scan == "N/A", null, scan)
EVAL-target = if(target == "" or target == "N/A", null, target)
EVAL-endpoint_machine = if(endpoint_machine == "" or endpoint_machine == "N/A", null, endpoint_machine)
EVAL-endpoint_user_name = if(endpoint_user_name == "" or endpoint_user_name == "N/A", null, endpoint_user_name)
EVAL-endpoint_user_id = if(endpoint_user_id == "" or endpoint_user_id == "N/A", null, endpoint_user_id)
EVAL-endpoint_user_title = if(endpoint_user_title == "" or endpoint_user_title == "N/A", null, endpoint_user_title)
EVAL-endpoint_user_department = if(endpoint_user_department == "" or endpoint_user_department == "N/A", null, endpoint_user_department)
EVAL-endpoint_user_email = if(endpoint_user_email == "" or endpoint_user_email == "N/A", null, endpoint_user_email)
EVAL-endpoint_user_phone = if(endpoint_user_phone == "" or endpoint_user_phone == "N/A", null, endpoint_user_phone)
EVAL-endpoint_user_mgr_name = if(endpoint_user_mgr_name == "" or endpoint_user_mgr_name == "N/A", null, endpoint_user_mgr_name)
EVAL-endpoint_user_mgr_title = if(endpoint_user_mgr_title == "" or endpoint_user_mgr_title == "N/A", null, endpoint_user_mgr_title)
EVAL-endpoint_user_mgr_phone = if(endpoint_user_mgr_phone == "" or endpoint_user_mgr_phone == "N/A", null, endpoint_user_mgr_phone)
EVAL-endpoint_user_mgr_email = if(endpoint_user_mgr_email == "" or endpoint_user_mgr_email == "N/A", null, endpoint_user_mgr_email)
EVAL-dataowner_name = if(dataowner_name == "" or dataowner_name == "N/A", null, dataowner_name)
EVAL-dataowner_email = if(dataowner_email == "" or dataowner_email == "N/A", null, dataowner_email)
EVAL-device_instance_id = if(device_instance_id == "" or device_instance_id == "N/A", null, device_instance_id)
EVAL-scan_date = if(scan_date == "" or scan_date == "N/A", null, scan_date)

#### split recipients ####
EVAL-recipients = if(recipients == "" or recipients == "N/A", null, split(recipients, ","))
EVAL-recipient_count = if(recipients == "" or recipients == "N/A", null, mvcount(split(recipients, ",")))

### CIM mapping for Alerts ###
EVAL-id = if(incident_id == "" or incident_id == "N/A", null, incident_id)
EVAL-dest = case(dataowner_name != "N/A" and dataowner_name != "", dataowner_name, destination_ip != "N/A" and destination_ip != "", destination_ip, true(), host)
EVAL-src = case(machine_ip != "N/A" and machine_ip != "", machine_ip, endpoint_machine != "N/A" and endpoint_machine != "", endpoint_machine, true(), null)
EVAL-signature = case(policy_rules != "" and policy_rules != "N/A", policy_rules)
EVAL-signature_id = case(policy_rules != "" and policy_rules != "N/A", policy_rules)
EVAL-app = "Symantec DLP"
EVAL-type = if(blocked == "Action Blocked", "alert", "event")
EVAL-description = case(application_name != "N/A" and application_name!="", application_name)
EVAL-user = case(application_user != "N/A" and application_user != "", application_user)
EVAL-user_name = case(application_user != "N/A" and application_user != "", application_user)

LOOKUP-symantec_dlp_action = symantec_dlp_action_lookup blocked OUTPUT action
LOOKUP-symantec_dlp_severity = symantec_dlp_severity_lookup vendor_severity OUTPUT severity
