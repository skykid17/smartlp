##
## SPDX-FileCopyrightText: 2024 Splunk, Inc.
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##
[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_box_setup.log*]
sourcetype = box:addon:setup:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_box.log*]
sourcetype = box:addon:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_box_live_monitor.log*]
sourcetype = box:addon:livemonitor:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_frmk_conf.log*]
sourcetype = box:addon:frmk:conf:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_frmk_rest.log*]
sourcetype = box:addon:frmk:rest:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_frmk_state_store.log*]
sourcetype = box:addon:frmk:statestore:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}

[source::...(/|\\)var(/|\\)log(/|\\)splunk(/|\\)ta_frmk.log*]
sourcetype = box:addon:frmk:log
SHOULD_LINEMERGE = true
BREAK_ONLY_BEFORE = \d{4}(-\d{2}){2}\s\d{2}(:\d{2}){2}\,\d{3}


[box:events]
KV_MODE = auto_escaped
EVAL-app = "Box"
FIELDALIAS-vendor_action = event_type AS vendor_action
EVAL-vendor_product = "Box"
EVAL-object = case(event_type IN ("CONTENT_WORKFLOW_POLICY_ADD","CONTENT_WORKFLOW_POLICY_RETIRE"),additional_details_retention_policy_type,event_type IN ("WORKFLOW_AUTOMATION_UPDATE","WORKFLOW_AUTOMATION_CREATE"),"workflow_automation", event_type IN ("METADATA_TEMPLATE_CREATE","METADATA_TEMPLATE_DELETE","METADATA_TEMPLATE_UPDATE"),additional_details_metadata_template_templateKey, true(),coalesce(source_login,source_item_name,source_folder_name,source_file_name,source_group_name))
EVAL-object_id = case(event_type IN ("CONTENT_WORKFLOW_POLICY_ADD","CONTENT_WORKFLOW_POLICY_RETIRE"),additional_details_retention_policy_id,event_type IN ("WORKFLOW_AUTOMATION_UPDATE","WORKFLOW_AUTOMATION_CREATE"),null(), event_type IN ("METADATA_TEMPLATE_CREATE","METADATA_TEMPLATE_DELETE","METADATA_TEMPLATE_UPDATE"),additional_details_metadata_template_id, true(),coalesce(source_id,source_item_id,source_folder_id,source_file_id,source_group_id))
EVAL-object_attrs = case(event_type IN ("CONTENT_WORKFLOW_POLICY_ADD","CONTENT_WORKFLOW_POLICY_RETIRE"),additional_details_retention_policy_type,event_type IN ("WORKFLOW_AUTOMATION_UPDATE","WORKFLOW_AUTOMATION_CREATE"),"workflow_automation", event_type="RETENTION_POLICY_ASSIGNMENT_ADD","retention_policy_assignment",event_type="GROUP_ADMIN_CREATED",additional_details_group_name,event_type="COLLABORATION_ROLE_CHANGE","role=Previewer",event_type="COLLABORATION_EXPIRATION" OR event_type="STORAGE_EXPIRATION" OR event_type="SHARE_EXPIRATION" OR event_type="UPDATE_SHARE_EXPIRATION","expiration",event_type="ANNOTATIONV2_CREATE","annotation",event_type="COMMENT_CREATE" OR event_type="COMMENT_DELETE" OR event_type="COMMENT_EDIT", "comment", event_type="METADATA_INSTANCE_CREATE" OR event_type="METADATA_INSTANCE_DELETE" OR event_type="METADATA_INSTANCE_UPDATE" ,"metadata_instance", event_type="METADATA_TEMPLATE_CREATE" OR event_type="METADATA_TEMPLATE_DELETE" OR event_type="METADATA_TEMPLATE_UPDATE" ,additional_details_metadata_template_scope, event_type="CHANGE_ADMIN_ROLE", "admin role", event_type="APPLICATION_CREATED", "application", event_type="DELETE_USER" OR event_type="EDIT_USER" OR event_type="NEW_USER", "user", event_type="GROUP_ADD_USER" OR event_type="GROUP_REMOVE_USER", additional_details_group_name, event_type="OAUTH2_ACCESS_TOKEN_REVOKE", "token", event_type="REMOVE_LOGIN_ACTIVITY_DEVICE", "login session", event_type="TASK_ASSIGNMENT_CREATE" OR event_type="TASK_ASSIGNMENT_UPDATE" OR event_type="TASK_CREATE" OR event_type="TASK_ASSIGNMENT_DELETE" OR event_type="TASK_UPDATE", "task", event_type="ADVANCED_FOLDER_SETTINGS_UPDATE", "folder settings", event_type="COLLABORATION_ACCEPT" OR event_type="COLLABORATION_INVITE" OR event_type="COLLABORATION_REMOVE", "collaboration", event_type="GROUP_CREATION" OR event_type="GROUP_DELETION" OR event_type="GROUP_EDITED", "group", event_type="ITEM_MODIFY" OR event_type="ITEM_OPEN", "item", event_type="EMAIL_ALIAS_REMOVE" OR event_type="EMAIL_ALIAS_ADD_UNCONFIRMED" OR event_type="EMAIL_ALIAS_CONFIRM", "email alias" , source_item_type="file", "file", source_item_type="folder", "directory", source_type="user", "user", isnotnull(source_file_id), "file", isnotnull(source_folder_id), "directory", isnotnull(source_group_id), "group", true(), event_type)
FIELDALIAS-object_path = source_parent_name AS object_path
EVAL-object_category = case(event_type IN ("CONTENT_WORKFLOW_POLICY_ADD","CONTENT_WORKFLOW_POLICY_RETIRE"),"policy",event_type IN ("WORKFLOW_AUTOMATION_UPDATE","WORKFLOW_AUTOMATION_CREATE"),"workflow", event_type IN ("METADATA_TEMPLATE_CREATE","METADATA_TEMPLATE_DELETE", "METADATA_TEMPLATE_UPDATE"), "metadata", event_type == "COLLABORATION_EXPIRATION" OR event_type == "COLLABORATION_ROLE_CHANGE", "directory", source_type == "user", "user", source_item_type == "file", "file", isnotnull(source_file_id), "file", source_item_type == "folder", "directory", isnotnull(source_folder_id), "directory", isnotnull(source_group_id), "group", true(), null())
FIELDALIAS-result = event_type AS result
FIELDALIAS-category = additional_details_shield_alert_rule_category AS category
EVAL-src_user = case(event_type IN ("GROUP_ADD_USER","NEW_USER","DELETE_USER","EDIT_USER","GROUP_ADD_FOLDER","GROUP_REMOVE_USER","GROUP_REMOVE_FOLDER","CHANGE_ADMIN_ROLE","GROUP_ADMIN_DELETED","GROUP_ADMIN_CREATED","OAUTH2_ACCESS_TOKEN_REVOKE","APPLICATION_CREATED","EMAIL_ALIAS_REMOVE","EMAIL_ALIAS_ADD_UNCONFIRMED","EMAIL_ALIAS_CONFIRM"), created_by_login, true(), null())
EVAL-src_user_name = case(event_type IN ("GROUP_ADD_USER","NEW_USER","DELETE_USER","EDIT_USER","GROUP_ADD_FOLDER","GROUP_REMOVE_USER","GROUP_REMOVE_FOLDER","CHANGE_ADMIN_ROLE","GROUP_ADMIN_DELETED","GROUP_ADMIN_CREATED","OAUTH2_ACCESS_TOKEN_REVOKE","APPLICATION_CREATED","EMAIL_ALIAS_REMOVE","EMAIL_ALIAS_ADD_UNCONFIRMED","EMAIL_ALIAS_CONFIRM"), created_by_name, true(), null())
EVAL-user_id = case(event_type == "FAILED_LOGIN", source_id, event_type == "LOGIN", source_id, true(), created_by_id)
EVAL-user = case(event_type == "SHIELD_ALERT",additional_details_shield_alert_user_email,source_type == "user", source_login, isnotnull(source_user_login), source_user_login, true(), created_by_login)
EVAL-user_name = case(event_type == "SHIELD_ALERT",additional_details_shield_alert_user_name,source_type == "user", source_name, isnotnull(source_user_name) AND isnotnull(source_user_login), source_user_name, true(), created_by_name)
EVAL-change_type = case(event_type IN ("WORKFLOW_AUTOMATION_UPDATE","WORKFLOW_AUTOMATION_CREATE"),"data",event_type IN ("COLLABORATION_EXPIRATION","COLLABORATION_ROLE_CHANGE"), "filesystem", source_type == "user", "AAA", isnotnull(source_folder_id), "filesystem", isnotnull(source_item_id), "filesystem", isnotnull(source_group_id), "AAA", true(), "filesystem")
EVAL-reason = case(event_type == "FAILED_LOGIN", "failure", event_type == "LOGIN", "success", true(), null())
EVAL-id = case(event_type IN ("ADD_LOGIN_ACTIVITY_DEVICE","SHARED_LINK_REDIRECT_OUT_OF_SHARED_CONTEXT","SHIELD_ALERT"), event_id, isnotnull(id), id, true(), null())
EVAL-signature_id = case(event_type IN ("ADD_LOGIN_ACTIVITY_DEVICE","SHARED_LINK_REDIRECT_OUT_OF_SHARED_CONTEXT","LOGIN","FAILED_LOGIN","ADMIN_LOGIN"), event_type, event_type == "SHIELD_ALERT", additional_details_shield_alert_rule_id,true(), null())
EVAL-severity = case(event_type IN ("ADD_LOGIN_ACTIVITY_DEVICE","SHARED_LINK_REDIRECT_OUT_OF_SHARED_CONTEXT"), "informational", event_type=="SHIELD_ALERT",additional_details_shield_alert_priority,true(), null())
EVAL-severity_id = if(event_type == "SHIELD_ALERT", additional_details_shield_alert_risk_score, null())
FIELDALIAS-file_hash = additional_details_shield_alert_alert_summary_malware_info_file_info_hash AS file_hash
FIELDALIAS-file_name = additional_details_shield_alert_alert_summary_malware_info_file_info_name AS file_name
EVAL-action = if(event_type == "SHIELD_ALERT",if(category == "Malicious Content",null(),"created"),null())
EVAL-status = if(event_type == "SHIELD_ALERT",if(category == "Malicious Content",null(),"success"),null())
EVAL-description = case(event_type == "ADD_LOGIN_ACTIVITY_DEVICE", "A user is logging in from a device we havenâ€™t seen before",event_type == "SHARED_LINK_REDIRECT_OUT_OF_SHARED_CONTEXT", "Shared link causes a redirect", event_type=="SHIELD_ALERT",additional_details_shield_alert_alert_summary_alert_activities,isnotnull(description), description, true(), null())
EVAL-command = "web"
EVAL-dest = "box.com"
EVAL-dvc = "box.com"
LOOKUP-event_type = box_action_status_lookup event_type OUTPUTNEW action, status
TIME_PREFIX = created_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false
FIELDALIAS-owner = source_owned_by_name as owner
FIELDALIAS-owner_id = source_owned_by_id as owner_id
FIELDALIAS-owner_email = source_owned_by_login as owner_email
FIELDALIAS-parent_object = source_parent_name as parent_object
FIELDALIAS-parent_object_category = source_parent_type as parent_object_category
FIELDALIAS-parent_object_id = source_parent_id as parent_object_id
FIELDALIAS-object_size = additional_details_size as object_size
FIELDALIAS-vendor_type = type AS vendor_type
EVAL-type = case(event_type IN ("ADD_LOGIN_ACTIVITY_DEVICE","SHARED_LINK_REDIRECT_OUT_OF_SHARED_CONTEXT"),"event",event_type == "SHIELD_ALERT",case(additional_details_shield_alert_priority == "critical", "alarm",additional_details_shield_alert_priority == "high", "alert",additional_details_shield_alert_priority == "low" OR additional_details_shield_alert_priority == "medium", "warning",additional_details_shield_alert_priority == "informational", "event"),true(),type)
EVAL-signature = case(event_type == "FAILED_LOGIN", "Failed login", event_type == "LOGIN", "Successful login", event_type == "ADMIN_LOGIN", "Admin console used to log in to a managed user's account", event_type == "SHIELD_ALERT", additional_details_shield_alert_rule_name,true(), null())
EVAL-user_role = if(event_type == "ADMIN_LOGIN","admin",null())
EVAL-user_type = if(event_type == "GROUP_ADMIN_CREATED","admin",null())
EXTRACT-src_ips = (?ms)(((additional_details_shield_alert_alert_summary_alert_activities|additional_details_shield_alert_alert_summary_download_ips)=\"\[|additional_details_shield_alert_alert_summary_sessions=\"\[.*?'session_type': 'suspicious').*?'ip':\s*')(?<src_ip>[^'|^"]+)
FIELDALIAS-src_ip = ip_address ASNEW src_ip
EVAL-src_ip = if(event_type == "SHIELD_ALERT" AND src_ip == "Unknown IP",null(),src_ip)
EVAL-src = if(event_type == "SHIELD_ALERT",if(category != "Malicious Content",src_ip,null()),ip_address)

[box:users]
EVAL-vendor_product = "Box"
KV_MODE = auto_escaped
EVAL-enabled = case(status == "inactive","false", 1=1,"true")
FIELDALIAS-user_id = id AS user_id
FIELDALIAS-family = type AS family
FIELDALIAS-description = name AS description
FIELDALIAS-user = login AS user
FIELDALIAS-user_role = role AS user_role
EVAL-dest = "box.com"
TIME_PREFIX = modified_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false

[box:groups]
EVAL-dest = "box.com"
FIELDALIAS-description = name AS description
FIELDALIAS-family = type AS family
FIELDALIAS-user_id = account_id AS user_id
EVAL-vendor_product = "Box"
KV_MODE = auto_escaped
TIME_PREFIX = created_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false

[box:folder]
FIELDALIAS-mount = location AS mount
EVAL-blocksize = size/1024
EVAL-vendor_product = "Box"
KV_MODE = auto_escaped
FIELDALIAS-status = item_status AS status
FIELDALIAS-vendor_parent = parent AS vendor_parent
FIELDALIAS-vendor_description = description AS vendor_description
EVAL-parent = coalesce(parent_name,parent)
EVAL-description = coalesce(name,description)
FIELDALIAS-family = type AS family
FIELDALIAS-user = created_by_name as user
EVAL-storage = size/1024/1024
EVAL-shared_link_access_level=case(shared_link_access=="open","Public", shared_link_access!="open","Private")
EVAL-dest = "box.com"
TIME_PREFIX = modified_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false

[box:folderCollaboration]
KV_MODE = auto_escaped
TIME_PREFIX = modified_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false
FIELDALIAS-family = item_type AS family
FIELDALIAS-description = type AS description
FIELDALIAS-name = item_name AS name
FIELDALIAS-mount = item_name AS mount
EVAL-dest = "box.com"
EVAL-vendor_product = "Box"


[box:fileComment]
KV_MODE = auto_escaped
TIME_PREFIX = modified_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false
EVAL-dest = "box.com"
FIELDALIAS-family = item_type AS family
FIELDALIAS-description = type AS description
EVAL-vendor_product = "Box"


[box:file]
KV_MODE = auto_escaped
TIME_PREFIX = modified_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false
EVAL-shared_link_access_level=case(shared_link_access=="open","Public", shared_link_access!="open","Private")
FIELDALIAS-mount = location AS mount
FIELDALIAS-version = version_number AS version
FIELDALIAS-serial = id AS serial
FIELDALIAS-family = type AS family
EVAL-blocksize = size/1024
FIELDALIAS-user = owned_by_name as user
EVAL-storage = size/1024/1024
EVAL-vendor_product = "Box"
EVAL-dest = "box.com"
FIELDALIAS-vendor_description = description AS vendor_description
EVAL-description = if(isnotnull(shared_link_download_url) AND shared_link_download_url!="", shared_link_download_url, name)


[box:fileTask]
KV_MODE = auto_escaped
TIME_PREFIX = created_at="
TIME_FORMAT = %Y-%m-%dT%H:%M:%S%:z
MAX_TIMESTAMP_LOOKAHEAD = 26
SHOULD_LINEMERGE = false
EVAL-dest = "box.com"
FIELDALIAS-family = item_type AS family
FIELDALIAS-name = item_name AS name
FIELDALIAS-description = type AS description
EVAL-vendor_product = "Box"

[box:filecontent]
SHOULD_LINEMERGE = true
TRUNCATE = 0

[box:filecontent:csv]
KV_MODE = multi
TRUNCATE = 0

[box:filecontent:xml]
KV_MODE = xml
SHOULD_LINEMERGE = true
TRUNCATE = 0

[box:filecontent:json]
INDEXED_EXTRACTIONS = json
TRUNCATE = 0
KV_MODE = none
