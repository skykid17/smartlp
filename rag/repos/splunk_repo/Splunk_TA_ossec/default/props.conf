##
## SPDX-FileCopyrightText: 2020 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-1-2020
##
##
[ossec]
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
KV_MODE = auto
REPORT-kv_for_ossec = kv_for_default_ossec,kv_for_splunk_ossec,component_kv_for_splunk_ossec,dest_kv_for_ossec,file_kv_for_splunk_ossec,source_port_kv_for_ossec,user_kv_for_default_ossec,file_size_kv_for_ossec,port_kv_for_ossec,dest_port_kv_for_ossec,command_kv_for_ossec
REPORT-signature_for_ossec = signature_id_for_default_ossec,signature_id_for_splunk_ossec
REPORT-object_kv_for_default_ossec_550_552 = object_kv_for_default_ossec_550_552
REPORT-object_kv_for_default_ossec_553 = object_kv_for_default_ossec_553
REPORT-object_kv_for_default_ossec_554 = object_kv_for_default_ossec_554
REPORT-object_kv_for_default_ossec_580_581 = object_kv_for_default_ossec_580_581
REPORT-object_kv_for_default_ossec_591_592 = object_kv_for_default_ossec_591_592
REPORT-object_kv_for_default_ossec_594_596 = object_kv_for_default_ossec_594_596
REPORT-object_kv_for_default_ossec_598 = object_kv_for_default_ossec_598
REPORT-object_kv_for_default_ossec_5303_5304 = object_kv_for_default_ossec_5303_5304
REPORT-object_kv_for_default_ossec_2932_2933_2934 = object_kv_for_default_ossec_2932_2933_2934
REPORT-object_kv_for_ossec_18103 = object_kv_for_ossec_18103
REPORT-object_kv_for_ossec_18130_18106 = object_kv_for_ossec_18130_18106
REPORT-object_kv_for_default_ossec_501_504 = object_kv_for_default_ossec_501_504
REPORT-object_kv_for_default_ossec_5902 = object_kv_for_default_ossec_5902
REPORT-object_kv_for_default_ossec_5555 = object_kv_for_default_ossec_5555
REPORT-object_kv_for_default_ossec_5710 = object_kv_for_default_ossec_5710
REPORT-source_ip_kv_for_ossec_18105_18153 = source_ip_kv_for_ossec_18105_18153
REPORT-object_kv_for_default_ossec_18147 = object_kv_for_default_ossec_18147
REPORT-object_kv_for_default_ossec_5901 = object_kv_for_default_ossec_5901

## Alias
FIELDALIAS-dvc = host as dvc
FIELDALIAS-COMMAND = command as COMMAND
FIELDALIAS-severity_id_for_ossec = crit as severity_id
FIELDALIAS-signature_id_for_ossec = id as signature_id
FIELDALIAS-signature_for_ossec = description as signature
FIELDALIAS-subject_for_ossec = description as subject
FIELDALIAS-src_for_ossec = src_ip as src
FIELDALIAS-md5_new_for_ossec = md5_new as file_hash
FIELDALIAS-body_for_ossec = message as body

## CIM Mapping
EVAL-user = CASE(signature_id IN("5304","5303"), src_user,true(),COALESCE(target_user, USER, acct, ruser))
EVAL-src_user = IF(isnull(src_user), acct, src_user)
EVAL-type = CASE(signature_id IN ("504","533","5706"), "event", signature_id IN ("11","501","510","512","555","1002","2502"), "alert", true(), type)
EVAL-service = CASE(signature_id IN ("502"), "ossec", true(), service)
EVAL-service_name = CASE(signature_id IN ("502"), "ossec-monitored", true(), service_name)
EVAL-object = CASE(signature_id IN ("5303","5304"), acct, signature_id IN ("2932","2933","2934"), package, signature_id IN ("593"), "Log", signature_id IN ("18145"), "Service Startup Policy", signature_id IN ("5901","5902"), name, true(), COALESCE(object,file_name,host_name,orig_source))
EVAL-object_id = CASE(signature_id IN ("5303","5304"), acct, signature_id IN ("2932","2933","2934"), package, signature_id IN ("5902"), UID, signature_id IN ("5901"), GID, true(), object_id)
EVAL-object_path = CASE(signature_id IN ("5902"), home, signature_id IN ("580","581"), orig_source, true(), file_path)
EVAL-object_attrs = CASE(signature_id IN ("2933"), "Package Version", signature_id IN ("592"), "File Size", true(), object_attrs)
EVAL-file_modify_time = if(signature_id IN (550, 551, 552, 553, 591, 592, 594, 595, 596, 598), strftime(_time,"%b %d %H:%M:%S"), null())
EVAL-file_create_time = if(signature_id IN (554, 598), strftime(_time,"%b %d %H:%M:%S"), null())
EVAL-dvc_ip = case(match(host,"\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}"), host)
EVAL-dvc_host = if(match(host,"\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}"), null(),host)
EVAL-vendor = "Open Source Security"
EVAL-product = "HIDS"
EVAL-vendor_product = "OSSEC:HIDS"
EVAL-app = CASE(signature_id IN ("5303","5304","5402","5405"), "su", signature_id IN ("5503","5715","5716"), "ssh", signature_id IN ("18106","18107","18149"), "win:local", match(signature_id, ".*"), "OSSEC:HIDS")
EVAL-ids_type = "host"

## Lookup
LOOKUP-severity_for_ossec = ossec_severities_lookup severity_id OUTPUT severity
LOOKUP-action_for_ossec = ossec_action_lookup signature_id AS ossec_signature_id OUTPUT action,status,change_type,change_type AS ossec_change_type
LOOKUP-object_category_for_ossec = ossec_object_category_lookup signature_id OUTPUT object_category
