
##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##

[crowdstrike_ta_build_host_resolution_table]
action.email.useNSSubject = 1
action.keyindicator.invert = 0
action.makestreams.param.verbose = 0
action.nbtstat.param.verbose = 0
action.notable.param.verbose = 0
action.nslookup.param.verbose = 0
action.ping.param.verbose = 0
action.risk.param.verbose = 0
action.send2uba.param.verbose = 0
action.threat_add.param.verbose = 0
alert.track = 0
cron_schedule = */11 * * * *
description = "Collects information to resolve event agent id into agent host information"
dispatch.earliest_time = -60d
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.mode = fast
display.page.search.tab = statistics
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = Splunk_TA_CrowdStrike_FDR
request.ui_dispatch_view = search
search = | tstats latest(AgentLocalTime) as AgentLocalTime latest(Time) as Time, latest(Timezone) as Timezone, latest(ComputerName) as ComputerName, latest(MachineDomain) as MachineDomain, latest(OU) as OU, latest(Version) as Version, latest(City) as City latest(Country) as Country latest(Continent) as Continent latest(SystemProductName) as SystemProductName latest(SiteName) as SiteName latest(event_platform) as event_platform \
where `crowdstrike_ta_aidmaster_index` sourcetype="crowdstrike:inventory:aidmaster" by aid \
| eval AgentLocalTime = if(AgentLocalTime = "none", null(), AgentLocalTime) \
| eval MachineDomain = if(MachineDomain = "none", null(), MachineDomain) \
| eval OU = if(OU = "none", null(), OU) \
| eval SiteName = if(SiteName = "none", null(), SiteName) \
| eval ComputerName = if(ComputerName = "none", null(), ComputerName) \
| eval City = if(City = "none", null(), City) \
| eval SystemProductName = if(SystemProductName = "none", null(), SystemProductName) \
| outputlookup crowdstrike_ta_host_resolution_lookup override_if_empty=false


[crowdstrike_ta_build_mac_ip_resolution_table]
action.email.useNSSubject = 1
action.keyindicator.invert = 0
action.makestreams.param.verbose = 0
action.nbtstat.param.verbose = 0
action.notable.param.verbose = 0
action.nslookup.param.verbose = 0
action.ping.param.verbose = 0
action.risk.param.verbose = 0
action.send2uba.param.verbose = 0
action.threat_add.param.verbose = 0
alert.track = 0
cron_schedule = */11 * * * *
description = "Collects information to resolve event agent id into agent host MAC and local ip address information"
dispatch.earliest_time = -60d
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.mode = fast
display.page.search.tab = statistics
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = Splunk_TA_CrowdStrike_FDR
request.ui_dispatch_view = search
search = | tstats latest(GatewayIP) as GatewayIP, latest(GatewayMAC) as GatewayMAC, latest(LocalAddressIP4) as LocalAddressIP4, latest(MAC) as MAC \
where `crowdstrike_ta_managedassets_index` sourcetype="crowdstrike:inventory:managedassets" by aid \
| outputlookup crowdstrike_ta_build_mac_ip_resolution_lookup override_if_empty=false


[crowdstrike_ta_merge_host_mac_ip_resolution_tables]
action.email.useNSSubject = 1
action.keyindicator.invert = 0
action.makestreams.param.verbose = 0
action.nbtstat.param.verbose = 0
action.notable.param.verbose = 0
action.nslookup.param.verbose = 0
action.ping.param.verbose = 0
action.risk.param.verbose = 0
action.send2uba.param.verbose = 0
action.threat_add.param.verbose = 0
alert.track = 0
cron_schedule = */3 * * * *
description = "Combines host resolution information from host information and mac & ip data into a single resolution table"
dispatch.earliest_time = -60d
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.mode = fast
display.page.search.tab = statistics
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = Splunk_TA_CrowdStrike_FDR
request.ui_dispatch_view = search
search = | inputlookup crowdstrike_ta_host_resolution_lookup \
| inputlookup crowdstrike_ta_build_mac_ip_resolution_lookup append=t \
| stats values(AgentLocalTime) AS AgentLocalTime values(City) AS City values(ComputerName) AS ComputerName values(Continent) AS Continent values(Country) AS Country values(MachineDomain) AS MachineDomain values(OU) AS OU values(SiteName) AS SiteName values(SystemProductName) AS SystemProductName values(Time) AS Time values(Timezone) AS Timezone values(Version) AS Version values(event_platform) AS event_platform values(GatewayIP) AS GatewayIP values(GatewayMAC) AS GatewayMAC values(LocalAddressIP4) AS LocalAddressIP4 values(MAC) AS MAC by aid \
| table aid AgentLocalTime City ComputerName Continent Country MachineDomain OU	SiteName SystemProductName Time Timezone Version event_platform	GatewayIP GatewayMAC LocalAddressIP4 MAC \
| outputlookup crowdstrike_ta_combined_host_resolution_lookup override_if_empty=false


[crowdstrike_ta_build_appinfo_resolution_table]
action.email.useNSSubject = 1
action.keyindicator.invert = 0
action.makestreams.param.verbose = 0
action.nbtstat.param.verbose = 0
action.notable.param.verbose = 0
action.nslookup.param.verbose = 0
action.ping.param.verbose = 0
action.risk.param.verbose = 0
action.send2uba.param.verbose = 0
action.threat_add.param.verbose = 0
alert.track = 0
cron_schedule = */11 * * * *
description = "Collects information to resolve event file SHA256HashData into application/file information"
dispatch.earliest_time = -60d
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.mode = fast
display.page.search.tab = statistics
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = Splunk_TA_CrowdStrike_FDR
request.ui_dispatch_view = search
search = | tstats latest(CompanyName) as CompanyName, latest(FileDescription) as FileDescription, latest(FileName) as FileName, latest(FileVersion) as FileVersion, latest(ProductName) as ProductName, latest(ProductVersion) as ProductVersion,  latest(detectionCount) as detectionCount \
where `crowdstrike_ta_appinfo_index` sourcetype="crowdstrike:inventory:appinfo" by SHA256HashData \
| outputlookup crowdstrike_ta_build_appinfo_resolution_lookup override_if_empty=false

[crowdstrike_ta_build_userinfo_resolution_table]
action.email.useNSSubject = 1
action.keyindicator.invert = 0
action.makestreams.param.verbose = 0
action.nbtstat.param.verbose = 0
action.notable.param.verbose = 0
action.nslookup.param.verbose = 0
action.ping.param.verbose = 0
action.risk.param.verbose = 0
action.send2uba.param.verbose = 0
action.threat_add.param.verbose = 0
alert.track = 0
cron_schedule = */11 * * * *
description = "Collects information to resolve event user sid into user information"
dispatch.earliest_time = -60d
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.mode = fast
display.page.search.tab = statistics
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = Splunk_TA_CrowdStrike_FDR
request.ui_dispatch_view = search
search = | tstats latest(AccountType) as AccountType, latest(LastLoggedOnHost) as LastLoggedOnHost, latest(LocalAdminAccess) as LocalAdminAccess, latest(LogonInfo) as LogonInfo, latest(LogonTime) as LogonTime, latest(LogonType) as LogonType, latest(PasswordLastSet) as PasswordLastSet, latest(User) as User, latest(UserIsAdmin) as UserIsAdmin, latest(UserLogonFlags_decimal) as UserLogonFlags, latest(UserName) as UserName, latest(event_platform) as event_platform, latest(monthsincereset) as monthsincereset \
where `crowdstrike_ta_userinfo_index` sourcetype="crowdstrike:inventory:userinfo" by UserSid_readable | rename  UserSid_readable as UserSid \
| outputlookup crowdstrike_ta_build_userinfo_resolution_lookup override_if_empty=false
