##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##

###### Sourcetype Routing

[pan_threat]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,THREAT,
FORMAT = sourcetype::pan:threat

[pan_traffic]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,TRAFFIC,
FORMAT = sourcetype::pan:traffic

[pan_system]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,SYSTEM,
FORMAT = sourcetype::pan:system

[pan_config]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,CONFIG,
FORMAT = sourcetype::pan:config

[pan_hipmatch]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,HIPMATCH,
FORMAT = sourcetype::pan:hipmatch

[pan_correlation]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,CORRELATION,
FORMAT = sourcetype::pan:correlation

[pan_userid]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,USERID,
FORMAT = sourcetype::pan:userid

[pan_globalprotect]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,GLOBALPROTECT,
FORMAT = sourcetype::pan:globalprotect

[pan_decryption]
DEST_KEY = MetaData:Sourcetype
REGEX = ^[^,]+,[^,]+,[^,]+,DECRYPTION,
FORMAT = sourcetype::pan:decryption

#### field extractions

[extract_threat]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","src_ip","dest_ip","src_translated_ip","dest_translated_ip","rule","src_user","dest_user","app","vsys","src_zone","dest_zone","src_interface","dest_interface","log_forwarding_profile","future_use3","session_id","repeat_count","src_port","dest_port","src_translated_port","dest_translated_port","session_flags","transport","action","misc","threat","raw_category","severity","direction","sequence_number","action_flags","src_location","dest_location","future_use4","content_type","pcap_id","file_hash","cloud_address","url_index","user_agent","file_type","xff","referrer","sender","subject","recipient","report_id","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name","future_use5","src_vm","dest_vm","http_method","tunnel_id","tunnel_monitor_tag","tunnel_session_id","tunnel_start_time","tunnel_type","threat_category","content_version","future_use6"

[extract_traffic]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","src_ip","dest_ip","src_translated_ip","dest_translated_ip","rule","src_user","dest_user","app","vsys","src_zone","dest_zone","src_interface","dest_interface","log_forwarding_profile","future_use3","session_id","repeat_count","src_port","dest_port","src_translated_port","dest_translated_port","session_flags","transport","action","bytes","bytes_out","bytes_in","packets","start_time","duration","http_category","future_use4","sequence_number","action_flags","src_location","dest_location","future_use5","packets_out","packets_in","session_end_reason","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name","action_source","src_vm","dest_vm","tunnel_id","tunnel_monitor_tag","tunnel_session_id","tunnel_start_time","tunnel_type"

[extract_config]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","host_name","vsys","command","admin","client","result","configuration_path","sequence_number","action_flags","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name"

[extract_system]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","vsys","event_id","object","future_use3","future_use4","module","severity","description","sequence_number","action_flags","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name"

[extract_correlation]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","src_ip","src_user","vsys","category","severity","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name","vsys_id","object","object_id","evidence"

# GlobalProtect extraction for PAN-OS 9.1.1+
[extract_globalprotect]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","future_use2","version","time_generated","vsys","event_id","stage","auth_method","tunnel_type","src_user","src_region","machine_name","public_ip","public_ipv6","private_ip","private_ipv6","host_id","serial_number","client_ver","client_os","client_os_ver","repeat_count","reason","error","opaque","status","location","login_duration","connect_method","error_code","portal","sequence_number","action_flags","event_time","selection_type","response_time","priority","attempted_gateways","gateway","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name","vsys_id"

[extract_decryption]
DELIMS = ","
FIELDS = "future_use1","receive_time","serial_number","log_type","log_subtype","version","generated_time","src_ip","dest_ip","src_translated_ip","dest_translated_ip","rule","src_user","dest_user","app","vsys","src_zone","dest_zone","src_interface","dest_interface","log_forwarding_profile","start_time","session_id","repeat_count","src_port","dest_port","src_translated_port","dest_translated_port","flags","IP_PROTOCOL","action","tunnel_id","future_use2","future_use3","src_vm_uuid","dest_vm_uuid","uuid_rule","stage_client_firewall","stage_firewall_client","tls_version","key_exchange_algorithm","encryption_algorithm","hash_algorithm","rule","elliptic_curve","error_index","root_status","chain_status","proxy_type","cert_serial_number","fingerprint","cert_start_time","cert_end_time","cert_version","cert_size","cn_length","issuer_cn_length","root_cn_length","sni_length","cert_flags","subject_cn","issuer_subject_cn","root_subject_cn","server_name","error","container_id","pod_namespace","pod_name","src_edl","dest_edl","src_dag","dest_dag","timestamp","src_dvc_category","src_dvc_profile","src_dvc_model","src_dvc_vendor","src_dvc_os","src_dvc_os_version","src_name","src_mac","dest_dvc_category","dest_dvc_profile","dest_dvc_model","dest_dvc_vendor","dest_dvc_os","dest_dvc_os_version","dest_name","dest_mac","sequence_number","action_flags","devicegroup_level1","devicegroup_level2","devicegroup_level3","devicegroup_level4","vsys_name","dvc_name","vsys_id","subcategory_of_app","category_of_app","technology_of_app","risk_of_app","characteristic_of_app","container_of_app","is_saas_of_app","sanctioned_state_of_app","cluster_name"

[extract_threat_id]
SOURCE_KEY = threat
REGEX = \((?<threat_id>\d+)\)

[extract_threat_name]
SOURCE_KEY = threat
REGEX = ^(?<threat_name>[^(]*)

[extract_object_attrs]
SOURCE_KEY = description
REGEX = (?<object_attrs>\d+.?\d+)

[extract_object_attrs_cloud]
SOURCE_KEY = EventDescription
REGEX = (?<object_attrs>\d+.?\d+)

[extract_auth_src_cloud]
SOURCE_KEY = EventDescription
REGEX = From: (?<src_auth>.+).

[extract_auth_user_cloud]
SOURCE_KEY = EventDescription
REGEX = user '(?<src_user_cloud>.+)'.

[extract_dest_hostname]
SOURCE_KEY = misc
REGEX = ^(?<dest_hostname>[^/]*)/

[extract_http_referrer_name]
SOURCE_KEY = referrer
REGEX = ^\w*://(?<http_referrer_name>[^/]*)/

[extract_major_content_type]
SOURCE_KEY = content_type
REGEX = ^(?<major_content_type>[^/]*)/

[extract_filename]
SOURCE_KEY = misc
REGEX = (?<file_name>[^/?]*)(?:\?.*){0,1}$

[extract_threat_id_cloud]
SOURCE_KEY = ThreatID
REGEX = \((?<threat_id>\d+)\)

[extract_threat_name_cloud]
SOURCE_KEY = ThreatID
REGEX = ^(?<threat_name>[^(]*)

[extract_dest_hostname_cloud]
SOURCE_KEY = URL
REGEX = ^(?<dest_hostname>[^/]*)/

[extract_major_content_type_cloud]
SOURCE_KEY = ContentType
REGEX = ^(?<major_content_type>[^/]*)/

[extract_url_domain]
SOURCE_KEY = misc
REGEX = ^(?:[^:]+:\/\/)?(?!(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\S+:\/\/))(?<url_domain>[^:\/]+)

[extract_user_auth]
SOURCE_KEY = description
REGEX = '(?<user>\w+)'

[extract_reason_auth]
SOURCE_KEY = description
REGEX = Reason: (?<reason_auth>.+)\.\s

[extract_auth_dest_ip]
SOURCE_KEY = future_use1
REGEX = (?<dest_ip>(\b25[0-5]|\b2[0-4][0-9]|\b[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3})

[extract_auth_src]
SOURCE_KEY = description
REGEX = From: (?<src_auth>.+).

# Global Protect syslog extractions (PANOS < 9.1.1)
[extract_globalprotect_user]
SOURCE_KEY =  description
REGEX = User name: (?<user>[^,]+)(,\s|\.$)

[extract_globalprotect_ip]
SOURCE_KEY =  description
REGEX = Private IP: (?<src_ip>(?:\d{1,3}\.){3}\d{1,3}+)

[extract_globalprotect_loginip]
SOURCE_KEY =  description
REGEX = Login from: (?<src_ip>(?:\d{1,3}\.){3}\d{1,3}+)

[extract_globalprotect_dest_loginip]
SOURCE_KEY =  opaque
REGEX = Login to: (?<dest_ip>(?:\d{1,3}\.){3}\d{1,3}+)

[extract_globalprotect_clientversion]
SOURCE_KEY =  description
REGEX = Client version: (?<agent_version>[^,]+)

[extract_globalprotect_message]
SOURCE_KEY =  description
REGEX = Message: (?<agent_message>[^,]+)

#### lookups

[endpoint_actions_lookup]
filename = endpoint_actions.csv
max_matches = 1
min_matches = 1

[pan_vendor_info_lookup]
filename = pan_vendor_info.csv

[pan_vendor_action_lookup]
filename      = pan_vendor_actions.csv
max_matches   = 1
min_matches   = 1
default_match = unknown

[threat_lookup]
filename = threat_list.csv

[app_lookup]
filename = app_list.csv

[classification_lookup]
filename = ip_classifications.csv
max_matches   = 1
min_matches   = 1
default_match = unknown
match_type    = CIDR(cidr)

[sanctioned_saas_lookup]
filename = sanctioned_saas.csv
max_matches = 1
min_matches = 1
default_match = no

[system_actions_lookup]
filename = system_actions.csv
max_matches = 1
min_matches = 1

[pan_severity_lookup]
filename = pan_severity.csv
max_matches = 1
min_matches = 1
