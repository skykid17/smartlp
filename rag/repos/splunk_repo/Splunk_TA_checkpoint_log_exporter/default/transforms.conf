##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##

## SOURCE TYPE
[kv_cp_log_format]
FORMAT = $1::$2
REGEX = ([a-zA-Z0-9_-]+):?=([^|]+)
MV_ADD = true
DEPTH_LIMIT = 100000

[kv_cp_syslog_log_format]
FORMAT = $1::$2
REGEX = ([a-zA-Z0-9_-]+):?="((?:[^"\\]|\\.)+)"
MV_ADD = true
DEPTH_LIMIT = 100000

## SOURCE
[checkpoint_audit_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)Web-UI|WEB_API|Log\sUpdate|smart_event|SmartUpdate|SmartConsole|license-mgmt|SmartDashboard|System\sMonitor|SmartEvent\sClient|SmartView|Scheduled\ssystem\supdate|Eventia\sAnalyzer\sClient|Security\sGateway\/Management|Smart\sDefense|LogUpdate|Log\s+Update|SmartDefense|Web_API_internal|Eventia\sAnalyzer\sClient|Connectra|Check\sPoint\sSecurity\sManagement\sServer|SmartProvisioning\sConnector|SmartLSM\sEndpoint\sSecurity\sConsole|SmartLSM|ROBO\s+GUI|Management\sBlade|CLI|Check\sPoint\sGo\sPassword\sReset|Database\sTool|query-database|cpmidu_update_tool|none)
FORMAT = source::checkpoint:audit
LOOKAHEAD = 10000

[checkpoint_email_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)MTA|Anti-Spam|Anti\sSpam|Anti\sPhishing|Anti-Phishing|Anti-Spam\sand\sEmail\sSecurity|Anti\sSpam\sand\sEmail\sSecurity)
FORMAT = source::checkpoint:email
LOOKAHEAD = 10000

[checkpoint_endpoint_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)Endpoint\sCompliance|Core|Endpoint\sManagement|Media\sEncryption\s&\sPort\sProtection|MEPP|Endpoint\sSecurity\sConsole|Endpoint)
FORMAT = source::checkpoint:endpoint
LOOKAHEAD = 10000

[checkpoint_firewall_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)Firewall|DLP|Application\sControl|RAD|HTTPS\sInspection|Compliance\sBlade|Compliance(?:\||\")|VPN-1\s&\sFirewall-1|Network\sSecurity|FG\sVPN-1\s&\sFireWall-1|QoS)
FORMAT = source::checkpoint:firewall
LOOKAHEAD = 10000

[checkpoint_firewall_subproduct_source]
DEST_KEY = MetaData:Source
REGEX = fw_subproduct="?(?:(?i)VPN)
FORMAT = source::checkpoint:sessions
LOOKAHEAD = 10000

[checkpoint_ids_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:IPS|WIFI|Cellular)
FORMAT = source::checkpoint:ids
LOOKAHEAD = 10000

[checkpoint_ids_malware_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)Threat\sEmulation|Anti\sVirus|New\sAnti\sVirus|Anti-Virus|Anti-Bot|Threat\sExtraction|Anti-Ransomware|Anti-Exploit|Forensics|OS\sExploit|Application(?:\||\")|Text\sMessage|Network\sAccess|Zero\sPhishing|Anti-Malware|Anti\sMalware\sNew\sAnti\sVirus|Anti\sMalware)
FORMAT = source::checkpoint:ids_malware
LOOKAHEAD = 10000

[checkpoint_sessions_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)VPN(?:\||\")|Mobile\sApp|Mobile(?:\||\")|Identity\sAwareness)
FORMAT = source::checkpoint:sessions
LOOKAHEAD = 10000

[checkpoint_web_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)URL\sFiltering)
FORMAT = source::checkpoint:web
LOOKAHEAD = 10000

[checkpoint_network_source]
DEST_KEY = MetaData:Source
REGEX = (?:\s+|\|)product="?(?:(?i)IOS\sProfile|Device|Mobile\sAccess|WIFI\sNetwork)
FORMAT = source::checkpoint:network
LOOKAHEAD = 10000

[checkpoint_default_source]
DEST_KEY = MetaData:Source
REGEX = product="?\S+
FORMAT = source::checkpoint:cp_default
LOOKAHEAD = 10000

## LOOKUP
[checkpoint_transport_protocols_lookup]
filename = checkpoint_transport_protocols.csv

[checkpoint_service_app]
filename = checkpoint_service_app.csv

## REPORT
[transforms_file_name_and_file_path]
SOURCE_KEY = file_name
REGEX = (.*(?:\\|\/)(.*))
FORMAT = extracted_file_path::$1 extracted_file_name::$2

[remediated_files_list]
SOURCE_KEY = remediated_files
REGEX = \s*(.*?)\((?:[^\)]*)\)(?:$|,)
FORMAT = remediated_files_list::$1
MV_ADD = true

[extract_endpoint_workgroup]
SOURCE_KEY = additional_info
REGEX = Workgroup\sName:\s*(\S+)
FORMAT = endpoint_workgroup::$1

[extract_endpoint_sid]
SOURCE_KEY = additional_info
REGEX = Object\sSID:\s*(\S+)
FORMAT = endpoint_sid::$1

[extract_endpoint_type]
SOURCE_KEY = additional_info
REGEX = Type:\s*(\S+)
FORMAT = endpoint_type::$1

[extract_endpoint_sam]
SOURCE_KEY = additional_info
REGEX = SAM\sName:\s*(\S+)
FORMAT = endpoint_sam::$1

[extract_src_for_identity_awareness]
SOURCE_KEY = information
REGEX = Inbound\sconnection\sfrom\s\S+\s((\d+\.\d+\.\d+\.\d+))
FORMAT = src::$1 src_ip::$2

[extract_authentication_method]
SOURCE_KEY = additional_info
REGEX = ^Authentication\smethod:\s(.*)
FORMAT = authentication_method::$1

[extract_interface_info]
SOURCE_KEY = fieldschanges
REGEX = ^Logical\sinterface\s\((([^\)]*))
FORMAT = object_id::$1 interface::$2

[url_domain_from_resource]
SOURCE_KEY = resource
REGEX = ^(?:[^:]+:\/\/)?(?!(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\S+:\/\/))([^:\/]+)
FORMAT = url_domain::$1

## Retain original src value
## Do not replace this extraction with field-alias
[extract_event_src]
SOURCE_KEY = src
REGEX = (.*)
FORMAT = event_src::$1
