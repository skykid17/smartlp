##
## SPDX-FileCopyrightText: 2024 Splunk, Inc.
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##

[cisco_esa_authentication]
search = (sourcetype="cisco:esa:authentication" OR sourcetype=cisco:esa:legacy) AND (user="*") AND NOT (session)

[cisco_esa_email]
search = (sourcetype="cisco:esa:textmail" OR sourcetype=cisco:esa:legacy) AND (MID OR ICID OR DCID OR RCID OR RID)

[cisco_esa_proxy]
search = (sourcetype="cisco:esa:http" OR sourcetype=cisco:esa:legacy) AND (cisco_esa_http_status="*" OR cisco_esa_dest="*")

[cisco_esa_amp]
search = (sourcetype="cisco:esa:amp") AND (disposition="MALICIOUS" OR disposition=3 OR malware="*")

[cisco_esa_cef]
search = (sourcetype="cisco:esa:cef") AND (act="*" OR ESAMID="*" OR ESAICID="*")
#tags = email

[cisco_esa_textmail]
search = (sourcetype="cisco:esa:textmail" AND ((recipient="*" AND mid="*" AND icid="*" AND rid="*") OR description="SDR: Domains for which SDR is requested"))
#tags = email

[cisco_esa_delivery]
search = (sourcetype="cisco:esa:delivery")
#tags = email

[cisco_esa_bounce]
search = (sourcetype="cisco:esa:bounce")
#tags = email

[cisco_esa_mar]
search = (sourcetype="cisco:esa:amp") AND (log_type="MAR*")

[cisco_esa_system_logs]
search = (sourcetype="cisco:esa:system_logs" OR sourcetype="cisco:esa:error_logs") AND ((name="lame DNS referral") OR (query_type="*" AND query_count="*"))
#tags = network resolution dns

[cisco_esa_http_session]
search = (sourcetype="cisco:esa:http") AND (action="started")
#tags = network session

[cisco_esa_logout_logs]
search = (sourcetype="cisco:esa:authentication" OR sourcetype="cisco:esa:http") AND (vendor_action="logged out" OR result="User * logged out*")

[cisco_esa_change_logs]
search = (sourcetype="cisco:esa:http" OR sourcetype="cisco:esa:textmail" OR sourcetype="cisco:esa:antispam" OR sourcetype="cisco:esa:content_scanner" OR sourcetype="cisco:esa:system_logs") AND (action IN("modified","started","restarted","stopped")) AND NOT (sourcetype="cisco:esa:authentication" AND result="User * logged out*") AND NOT signature IN ("*The HTTP* session has been established successfully*")
#tags = change

[cisco_esa_account_management_logs]
search =  change_type="AAA" AND (((sourcetype="cisco:esa:authentication" OR sourcetype="cisco:esa:http") AND result="User * logged out*") OR (sourcetype="cisco:esa:system_logs" AND result="*performed user management action*") OR (sourcetype="cisco:esa:http" AND result="Passphrase has been changed*"))
#tags = account change

[cisco_esa_auth_logs]
search = (sourcetype="cisco:esa:authentication" OR sourcetype=cisco:esa:legacy) AND (action IN("success","failure"))
#tags = authentication

[cisco_esa_web_logs]
search = (sourcetype="cisco:esa:http") AND (http_method=*)
#tags = web

[cisco_esa_alerts]
search = (sourcetype="cisco:esa:error_logs" AND (description="Internal SMTP giving up*" OR description="*failed to connect to host*" OR description="*Failed to connect to remote host*" OR description="Unable to look up*" OR description="Unable to send*" OR description="SCP failed to transfer to *")) OR (sourcetype="cisco:esa:textmail" AND (alert_recipient="*" OR signature="Network is down" OR  description IN ("URL category definitions have changed*","Failed to send message to host*","Internal SMTP giving up on message to*","Internal SMTP system attempting to send a message to*","Unable to look up*","Unable to send*","Your*key will expire*","SCP failed to transfer*","DNS failure for SMTP route*","Log * pushed via FTP to remote host*","Error generating Service Log Client configuration*","*file reputation verdict :*","*was too big * for scanning by Outbreak Filters","antivirus positive*","Threat Level=* Category=* Type=*","Bounced by*","Error during verification*","Message from domain *, DMARC fail*","Unknown address error*","Dropped by antivirus","Received an invalid DNS Response:*","enqueued for transfer *","*reached maximum messages-per-connection limit.","AMP file reputation verdict*") OR subject="DLP violation")) OR (sourcetype="cisco:esa:system_logs" AND (description="Failed to bootstrap the DNS resolver.*" OR description="DNS query network error*" OR description="Unable to look up*" OR description="Received an invalid DNS Response*" OR description="Internal SMTP*" OR description="A * alert was sent to*" OR description="SCP failed to transfer to*" OR description="Unable to send*" OR description="User * commit changes" OR description="The following update to the interface failed" OR description="TLS connection failed because of an unsupported protocol issue*") OR description="*Error occurred while sending ESA message results for*") OR (sourcetype="cisco:esa:http" AND (description="*page not found" OR description="The URL accessed is invalid" OR description="Unable to send*" OR subject="Could not fetch*" OR subject="SSL error with client" OR subject="PERIODIC REPORTS" OR subject="Session not found" OR description="Internal SMTP*")) OR (sourcetype="cisco:esa:amp" AND NOT action IN ("blocked", "deferred") AND (malware=* OR description="The file is marked as malicious*")) OR (sourcetype="cisco:esa:antispam" AND description="bayes: cannot open bayes databases*") OR (sourcetype="cisco:esa:amp" AND (description IN ("Archive Error*","reputation query failed for attachment*","Perceptive filters*","Malformed header detected*","Error in initializing FireAMP Engine*")))
#tags = alert

[cisco_esa_amp_malware]
search = (sourcetype="cisco:esa:amp" AND action IN ("blocked", "deferred"))
#tags = malware attack

[cisco_esa_endpoint_ports]
search = (sourcetype="cisco:esa:http" AND (dest="*" AND dest_port="*" AND transport="*"))
#tags = listening port

[cisco_esa_network_traffic]
search = (((sourcetype="cisco:esa:textmail" AND flow_id="*" AND src="*") OR (sourcetype="cisco:esa:http"  AND action IN ("started","ended","blocked"))) AND transport="*" AND protocol="*" AND dvc="*")
#tags = network communicate

[cisco_esa_network_sessions_start]
search = ((sourcetype="cisco:esa:http" OR sourcetype="cisco:esa:system_logs") AND action IN ("started","ended","blocked") AND (signature IN ("*The HTTP* session has been established successfully*")))
#tags = network session start
