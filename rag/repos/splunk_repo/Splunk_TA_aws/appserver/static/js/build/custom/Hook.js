import{_ as e,a as t,c as n,b as a,d as r,e as s,f as u,g as o,h as i}from"./_rollupPluginBabelHelpers-5e3fb531.js";import{g as l}from"./GlobalConfigUtil-bb3614f5.js";import{P as c,r as _,R as d,C as f,c as p,S as m,M as v,F as h,a as w,b as g,d as b,m as y}from"./vendor-51b680e2.js";import{d as k,a as S}from"./SourceInput-093f7402.js";import{T as x}from"./Theme-d82290ef.js";import{APP_NAME as N,QUEUE_NOT_FOUND_ERROR as E,DLQ_REQUIRED_ERROR as q,VISIBILITY_TIMEOUT_WARNING as R,SQS_BASED_S3_SOURCETYPES as F,LOG_NAME_FORMAT_POSTFIX as j,SPLUNK_TA_AWS_LOGS_SOURCETYPES as M,MAX_TIME as L,SERVICES_WITH_GROUP_SELECTION as O,SERVICES_WITH_CONFLICT_FIELDS as A}from"./consts.js";var C=new(function(){function n(){t(this,n)}return e(n,[{key:"getServiceLocationMap",value:function(){return{aws_config:"aws.config",aws_config_rule:"aws.configrules",aws_cloudwatch:"aws.cloudwatch",aws_cloudwatch_logs:"aws.cloudwatchlogs",aws_s3:"aws.s3",splunk_ta_aws_logs:"aws.incrementals3",aws_sqs_based_s3:"aws.sqs_based_s3",aws_billing:"aws.billing",aws_billing_cur:"aws.billing.cur",aws_cloudtrail:"aws.cloudtrail",aws_kinesis:"aws.kinesis",aws_inspector:"aws.inspector",aws_inspector_v2:"aws.inspectorv2",splunk_ta_aws_sqs:"aws.sqs",aws_metadata:"aws.metadata"}}},{key:"getAllLinks",value:function(){return{SQS_BASED_S3:"aws.configure_aws.configure_sqs"}}},{key:"buildInputLink",value:function(e){var t=D()[e],n='<a data-test="link" id="aws-learn-more-header-link" target="_blank" class="imDUvl" href="/help?location='.concat(encodeURIComponent("[AddOns:released]")).concat(t,'">').concat("Learn more",'<svg focusable="false" height="8px" width="8px" viewBox="0 0 1500 1499" aria-hidden="false" class="help-link-icon"><path d="M1500 1125h-189.04v185.96H189.04V189.04H375V0H0v1500h1500v-375zm0-1125H723.288v190.068h469.52l-666.78 648.288 133.56 134.59 650.344-665.754v469.52l189.04 1.028L1500 0z"></path></svg></a>'),a=document.createElement("a");return a.innerHTML=n,a}}]),n}()),I=C.buildInputLink;C.getAllLinks;var D=C.getServiceLocationMap,P=_.exports.createContext({regions:[],setRegions:function(){},queues:[],setQueues:function(){},effectiveState:{},setEffectiveState:function(){}}),V=function(e){var t=e.hookProps,a=e.children,r=t.initFormRows,s=t.setFormState,u=t.serviceName,o=t.initAccount,i=t.initAwsIamRole,l=_.exports.useState(o),c=n(l,2),f=c[0],p=c[1],m=_.exports.useState(i),v=n(m,2),h=v[0],w=v[1],g=_.exports.useState(r),b=n(g,2),y=b[0],k=b[1],S=_.exports.useState({}),x=n(S,2),N=x[0],E=x[1],q=_.exports.useState({}),R=n(q,2),F=R[0],j=R[1],M=_.exports.useState({}),L=n(M,2),O=L[0],A=L[1];return d.createElement(P.Provider,{value:{setFormState:s,serviceName:u,account:f,setAccount:p,awsIamRole:h,setAwsIamRole:w,effectiveFormRows:y,setEffectiveFormRows:k,regions:N,setRegions:E,queues:F,setQueues:j,rules:O,setRules:A},__self:undefined,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/hooks/useFormData.jsx",lineNumber:30,columnNumber:5}},a)};V.propTypes={hookProps:c.object.isRequired,children:c.oneOfType([c.arrayOf(c.node),c.node]).isRequired};var z=function(){return _.exports.useContext(P)},T=/REST Error \[([0-9]+)\]: (.*)\\".  See/,U=function(e){return fetch(e,{method:"GET",headers:{"X-Splunk-Form-Key":f,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))},Y=function(e,t,n,r){"function"==typeof t.text?t.text().then((function(t){var s=t.match(T),u=s&&3===s.length?"[".concat(s[1],"] ").concat(s[2]):t;n("function"==typeof r?function(t){return r(t,"".concat(e).concat(u))}:function(t){var n=a({},t);return n.errorMsg="".concat(e).concat(u),n})})):n((function(n){var r=a({},n);return r.errorMsg="".concat(e).concat(t),r}))},Q=function(e,t,n){var a=new URL(p("splunk_ta_aws/splunk_ta_aws_sqs_queue_names"),location),r=new URLSearchParams({aws_account:e,aws_region:t,output_mode:"json",count:"0"});return n&&r.set("aws_iam_role",n),a.search=r.toString(),a},H="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/QueueInput.jsx",J={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"};function X(e){var t=this,r=e.initValue,s=e.effectiveRegion,u=e.index,o=e.handleFormStateUpdate,i=z(),l=i.queues,c=i.setQueues,f=i.account;i.setFormState;var p=_.exports.useState(r),v=n(p,2),h=v[0],w=v[1],g=_.exports.useState([]),b=n(g,2),y=b[0],k=b[1],S=_.exports.useState(!1),x=n(S,2),N=x[0],E=x[1],q=_.exports.useState(s),R=n(q,2),F=R[0],j=R[1],M=function(e){e&&o(u,s,null),w(),k([]),E(!1)};return _.exports.useEffect((function(){var e;f||M(!1),void 0!==(null===(e=l[f])||void 0===e?void 0:e[s])&&(k(l[f][s].map((function(e){return d.createElement(m.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:H,lineNumber:49,columnNumber:29}})}))),s!==F&&(j(s),o(u,s,null),w()),E(!1))}),[f,s,l]),_.exports.useEffect((function(){var e;f&&s&&void 0===(null===(e=l[f])||void 0===e?void 0:e[s])&&(E(!0),U(Q(f,s)).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},l);n[f]=n[f]||{},n[f][s]=t.map((function(e){return{label:e.name,value:e.name}})),c(n)})).catch((function(e){M(!0);var t="Failed to get SQS Queues for Region ".concat(s,". ");Y(t,e)})))}),[f,s]),d.createElement(m,{value:h,onChange:function(e,t){var n=t.value;o(u,s,n),w(n)},disabled:N,placeholder:N?"Loading...":"Select an account and a region first",style:J,filter:!0,inline:!0,__self:this,__source:{fileName:H,lineNumber:97,columnNumber:5}},y)}var W=_.exports.memo(X),B="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RulesInput.jsx",G={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"};function Z(e){var t=this,r=e.initValue,s=e.effectiveRegion,u=e.index,o=e.handleFormStateUpdate,i=z(),l=i.rules,c=i.setRules,f=i.account,m=i.awsIamRole,h=i.setFormState,w=_.exports.useState(r),g=n(w,2),b=g[0],y=g[1],k=_.exports.useState([]),S=n(k,2),x=S[0],N=S[1],E=_.exports.useState(!1),q=n(E,2),R=q[0],F=q[1],j=_.exports.useState(s),M=n(j,2),L=M[0],O=M[1],A=function(e){e&&o(u,s,[]),y([]),N([]),F(!1)};return _.exports.useEffect((function(){var e;f||A(!1),void 0!==(null===(e=l[f])||void 0===e?void 0:e[s])&&(N(l[f][s].map((function(e){return d.createElement(v.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:B,lineNumber:52,columnNumber:7}})}))),s!==L&&(O(s),o(u,s,[]),y([])),F(!1))}),[f,s,l]),_.exports.useEffect((function(){var e;f&&s&&void 0===(null===(e=l[f])||void 0===e?void 0:e[s])&&(F(!0),U(function(e,t,n){var a=new URL(p("splunk_ta_aws/splunk_ta_aws_config_rules"),location),r=new URLSearchParams({aws_account:e,aws_region:t,output_mode:"json",count:"0"});return n&&r.set("aws_iam_role",n),a.search=r.toString(),a}(f,s,m)).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},l);n[f]=void 0===n[f]?{}:n[f],n[f][s]=t.map((function(e){return{label:e.name,value:e.name}})),c(n)})).catch((function(e){var t="Failed to get Config Rules for Region ".concat(s,". ");Y(message,e,h,(function(e,n){var r=a({},e);return r.data.region.value.includes(s)&&(A(!0),o(u,s,null,t),r.errorMsg=n),r}))})))}),[f,s]),d.createElement(v,{values:b,onChange:function(e,t){var n=t.values;o(u,s,n),y(n)},disabled:R,placeholder:R?"Loading...":"Leave blank to select all rules in this region",style:G,inline:!0,__self:this,__source:{fileName:B,lineNumber:112,columnNumber:5}},x)}var K=_.exports.memo(Z),$="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/MultiQueueInput.jsx",ee={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"};function te(e){var t=this,r=e.initValue,s=e.effectiveRegion,u=e.index,o=e.handleFormStateUpdate,i=z(),l=i.queues,c=i.setQueues,f=i.account,p=i.awsIamRole,m=i.setFormState,h=_.exports.useState(r),w=n(h,2),g=w[0],b=w[1],y=_.exports.useState([]),k=n(y,2),S=k[0],x=k[1],N=_.exports.useState(!1),E=n(N,2),q=E[0],R=E[1],F=_.exports.useState(s),j=n(F,2),M=j[0],L=j[1],O=function(e){e&&o(u,s,[]),b([]),x([]),R(!1)};return _.exports.useEffect((function(){var e;f||O(!1),void 0!==(null===(e=l[f])||void 0===e?void 0:e[s])&&(x(l[f][s].map((function(e){return d.createElement(v.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:$,lineNumber:51,columnNumber:7}})}))),s!==M&&(L(s),o(u,s,[]),b([])),R(!1))}),[f,s,l]),_.exports.useEffect((function(){var e;f&&s&&void 0===(null===(e=l[f])||void 0===e?void 0:e[s])&&(R(!0),U(Q(f,s,p)).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},l);n[f]=n[f]||{},n[f][s]=t.map((function(e){return{label:e.name,value:e.name}})),c(n)})).catch((function(e){O(!0);var t="Failed to get SQS Queues for Region ".concat(s,". ");Y(t,e,m)})))}),[f,s]),d.createElement(v,{values:g,onChange:function(e,t){var n=t.values;o(u,s,n),b(n)},disabled:q,placeholder:q?"Loading...":"Select an account and a region first",style:ee,inline:!0,__self:this,__source:{fileName:$,lineNumber:102,columnNumber:5}},S)}var ne=_.exports.memo(te),ae="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RegionInput.jsx",re={flex:"0 0 150px",display:"flex",alignItems:"center"};function se(e){var t=this,r=e.initValue,s=e.handleChangeRegion,u=e.index,o=e.handleFormStateUpdate,i=e.handleFormStateDelete,l=z(),c=l.regions,f=l.setRegions,v=l.serviceName,h=l.account,w=l.setFormState,g=_.exports.useState([]),b=n(g,2),y=b[0],k=b[1],S=_.exports.useState(!1),x=n(S,2),N=x[0],E=x[1],q=_.exports.useState(r),R=n(q,2),F=R[0],j=R[1],M=function(){i(u),j(),k([]),E(!1)};return _.exports.useEffect((function(){h||M(),void 0!==c[h]&&(k(c[h].map((function(e){return d.createElement(m.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:ae,lineNumber:64,columnNumber:7}})}))),E(!1))}),[h,c]),_.exports.useEffect((function(){h&&void 0===c[h]&&(E(!0),U(function(e,t){var n=new URL(p("splunk_ta_aws/splunk_ta_aws_regions"),location),a=new URLSearchParams({aws_service:t,aws_account:e,output_mode:"json",count:"0"});return n.search=a.toString(),n}(h,v)).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},c);n[h]=t.map((function(e){return{label:e.content.label,value:e.name}})),f(n)})).catch((function(e){M();var t="Failed to get Region for Account ".concat(h,". ");Y(t,e,w)})))}),[h]),d.createElement("div",{style:re,__self:this,__source:{fileName:ae,lineNumber:102,columnNumber:5}},d.createElement(m,{value:F,onChange:function(e,t){var n=t.value;j(n),s(n),o(u,n,"aws_config_rule"===v||"splunk_ta_aws_sqs"===v?[]:null),w((function(e){var t=a({},e);return t.errorMsg="",t}))},disabled:N,placeholder:N?"Loading...":"Select...",style:{width:"150px",minWidth:"100%",borderColor:"rgb(195, 203, 212)"},filter:!0,inline:!0,__self:this,__source:{fileName:ae,lineNumber:103,columnNumber:7}},y))}var ue=_.exports.memo(se),oe="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/SingleInputWrapper.jsx",ie={display:"inline-flex",lineHeight:"32px",flex:"0 0 30px",justifyContent:"center",alignItems:"center"};function le(e){var t=this,a=e.initValue,s=e.index,u=e.handleFormStateUpdate,o=e.handleFormStateDelete,i=_.exports.useState(null==a?void 0:a.region),l=n(i,2),c=l[0],f=l[1],p=z().serviceName,m=_.exports.useState(null),v=n(m,2),h=v[0],w=v[1],g={effectiveRegion:c,index:s,handleFormStateUpdate:u};return _.exports.useEffect((function(){switch(p){case"splunk_ta_aws_sqs":w(d.createElement(ne,r({initValue:null==a?void 0:a.queues},g,{__self:t,__source:{fileName:oe,lineNumber:38,columnNumber:11}})));break;case"aws_config":w(d.createElement(W,r({initValue:null==a?void 0:a.queues},g,{__self:t,__source:{fileName:oe,lineNumber:43,columnNumber:11}})));break;default:w(d.createElement(K,r({initValue:null==a?void 0:a.rules},g,{__self:t,__source:{fileName:oe,lineNumber:48,columnNumber:11}})))}return function(){o(s)}}),[c,p]),d.createElement("div",{style:{display:"flex"},__self:this,__source:{fileName:oe,lineNumber:60,columnNumber:5}},d.createElement(ue,r({initValue:null==a?void 0:a.region,handleChangeRegion:f,handleFormStateDelete:o},g,{__self:this,__source:{fileName:oe,lineNumber:61,columnNumber:7}})),d.createElement("span",{style:ie,__self:this,__source:{fileName:oe,lineNumber:67,columnNumber:7}}),h)}var ce=_.exports.memo(le),_e="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/CustomFormRows.jsx";function de(){var e=this,t=_.exports.useState([]),r=n(t,2),s=r[0],u=r[1],o=_.exports.useState("Config Rules"),i=n(o,2),l=i[0],c=i[1],f=z(),p=f.setAccount,m=f.setAwsIamRole,v=f.serviceName,g=f.setFormState,b=f.effectiveFormRows,y=f.setEffectiveFormRows;_.exports.useEffect((function(){window.setAccount=function(e){p(e)},window.setAwsIamRole=function(e){m(e)},"splunk_ta_aws_sqs"===v?c("SQS Queues"):"aws_config"===v&&c("SQS Queue")}),[]),_.exports.useEffect((function(){Object.entries(b).length>0?u(Object.entries(b).map((function(e,t){var a=n(e,2),r=a[0],s=a[1];return S(t,r,s)}))):u([S(0,Date.now().toString(36)+Math.random().toString(36).substring(2))])}),[]),_.exports.useEffect((function(){var e=[],t=[],r=[],s=[];Object.entries(b).forEach((function(a){var u=n(a,2);u[0];var o=u[1];e.push(o.region),"aws_config_rule"===v?(r.push(o.rules&&o.rules.join(",")),s.push(o.error)):"splunk_ta_aws_sqs"===v?t.push(o.queues&&o.queues.join(",")):t.push(o.queues)})),g((function(n){var u=a({},n);return"aws_config_rule"===v?function(e,t,n,a,r){return e.data.region.value=JSON.stringify(0===t.length?[""]:t),e.data.rule_names.value=JSON.stringify(0===n.length?[""]:n),e.data.rule_names.custom_errors=JSON.stringify(0===a.length?[""]:a),e}(u,e,r,s):"splunk_ta_aws_sqs"===v?function(e,t,n){return e.data.aws_region.value=JSON.stringify(0===t.length?[""]:t),e.data.sqs_queues.value=JSON.stringify(0===n.length?[""]:n),e}(u,e,t):function(e,t,n){return e.data.aws_region.value=JSON.stringify(0===t.length?[""]:t),e.data.sqs_queue.value=JSON.stringify(0===n.length?[""]:n),e}(u,e,t)}))}),[b]);var k=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y((function(s){var u=a({},s);return u[e]="aws_config_rule"===v?{region:t,rules:n,error:r}:{region:t,queues:n},u}))},S=function(t,n,a){return d.createElement(h.Row,{index:t,key:w(),onRequestRemove:N,__self:e,__source:{fileName:_e,lineNumber:117,columnNumber:5}},d.createElement(ce,{index:n,initValue:a,handleFormStateUpdate:k,handleFormStateDelete:x,__self:e,__source:{fileName:_e,lineNumber:122,columnNumber:7}}))},x=function(e){y((function(t){var n=a({},t);return delete n[e],n}))},N=function(e,t){var n=t.index;u((function(e){return 1===e.length?e:h.removeRow(n,e)}))},E=d.createElement("div",{__self:this,__source:{fileName:_e,lineNumber:162,columnNumber:5}},d.createElement("span",{style:{display:"inline-block",width:180},id:"header-key",__self:this,__source:{fileName:_e,lineNumber:163,columnNumber:7}},"Region"),d.createElement("span",{style:{display:"inline-block"},id:"header-value",__self:this,__source:{fileName:_e,lineNumber:172,columnNumber:7}},l));return d.createElement(h,{addLabel:"Add Another",header:E,onRequestAdd:function(){u((function(e){var t=Date.now().toString(36)+Math.random().toString(36).substring(2);return y((function(e){var n=a({},e);return n[t]={},n})),h.addRow(S(e.length,t),e)}))},style:{width:500},__self:this,__source:{fileName:_e,lineNumber:179,columnNumber:5}},s)}var fe=_.exports.memo(de),pe="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/FormRowsWrapper.jsx";function me(e){var t=e.hookProps;return d.createElement(g.SplunkThemeProvider,r({},x,{__self:this,__source:{fileName:pe,lineNumber:17,columnNumber:5}}),d.createElement(V,{hookProps:t,__self:this,__source:{fileName:pe,lineNumber:18,columnNumber:7}},d.createElement(fe,{__self:this,__source:{fileName:pe,lineNumber:19,columnNumber:9}})))}var ve=["service","input"],he=function(e){return{key:e,prop:"display",value:!1}},we=function(e){return{key:e,prop:"display",value:!0}},ge=function(e){return{key:e,prop:"disabled",value:!0}},be=function(){var e=window.location.pathname;setTimeout((function(){return window.history.pushState({},"",e)}))},ye=function(e,t,a){var r=function(){var e,t=document.location.search||document.location.hash,a={},r=new URLSearchParams(t.slice(1)),s=u(r.entries());try{for(s.s();!(e=s.n()).done;){var o=n(e.value,2),i=o[0],l=o[1];a[i]=l}}catch(e){s.e(e)}finally{s.f()}return a}(),s=r.input,o=r.service;if(!s||"edit"===e||"clone"===e){var i=function(e){var t={};return Object.keys(e).forEach((function(n){t[n]=e[n].value})),t}(t);s=k(i,a)}return{input:s,service:o}},ke=function(){var e=o(regeneratorRuntime.mark((function e(t,n){var a,r,s,u,o,i,l,c,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="splunk_ta_aws/splunk_ta_aws_sqs_queue_attributes?aws_account=".concat(t.aws_account,"&aws_region=").concat(t.sqs_queue_region,"&sqs_queue_url=").concat(t.sqs_queue_url,"&private_endpoint_enabled=").concat(t.private_endpoint_enabled,"&sts_private_endpoint_url=").concat(t.sts_private_endpoint_url,"&sqs_private_endpoint_url=").concat(t.sqs_private_endpoint_url,"&output_mode=json"),(r=t.aws_iam_role)&&(a+="&aws_iam_role=".concat(r)),s=p(a,{app:N,sharing:"app"}),u=t.using_dlq,e.prev=5,e.next=8,fetch(s,{method:"GET",headers:{"X-Splunk-Form-Key":f,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}});case 8:if(200!==(o=e.sent).status){e.next=26;break}return e.next=12,o.json();case 12:if(i=e.sent,l=i.entry[0].content,c=l.VisibilityTimeout,_=l.RedrivePolicy,0==u||_){e.next=21;break}return n("sqs_queue_url",q),e.abrupt("return",!1);case 21:if(!(0!==u&&c<300)){e.next=24;break}return n("sqs_queue_url",R),e.abrupt("return",!1);case 24:e.next=28;break;case 26:return n("sqs_queue_url",E),e.abrupt("return",!1);case 28:e.next=34;break;case 30:return e.prev=30,e.t0=e.catch(5),n("sqs_queue_url","validation of selected SQS queue failed. ERROR : ".concat(e.t0)),e.abrupt("return",!1);case 34:return e.abrupt("return",!0);case 35:case"end":return e.stop()}}),e,null,[[5,30]])})));return function(t,n){return e.apply(this,arguments)}}(),Se=function(e,t,n){return"edit"===e||"clone"===e?"aws_config_rule"===n?function(e){var t=[],n=JSON.parse(e.data.region.value),a=JSON.parse(e.data.rule_names.value).map((function(e){return e.split(",")}));return n.forEach((function(e,n){t[Date.now().toString(36)+Math.random().toString(36).substring(2)]={region:e,rules:a[n]}})),t}(t):function(e,t){var n=[],a=JSON.parse(e.data.aws_region.value),r=null;return r="splunk_ta_aws_sqs"===t?JSON.parse(e.data.sqs_queues.value).map((function(e){return e.split(",")})):JSON.parse(e.data.sqs_queue.value),a.forEach((function(e,t){n[Date.now().toString(36)+Math.random().toString(36).substr(2)]={region:e,queues:r[t]}})),n}(t,n):{}},xe=function(e,t,n,a){var r,s,u,o,i,l,c,_,f,p,m,v=(null===(r=e.data)||void 0===r||null===(s=r.account)||void 0===s?void 0:s.value)||(null===(u=e.data)||void 0===u||null===(o=u.aws_account)||void 0===o?void 0:o.value),h=null===(i=e.data)||void 0===i||null===(l=i.aws_iam_role)||void 0===l?void 0:l.value,w=Se(a,e,t);c="#group_selection",_=function(){b.render(d.createElement(me,{hookProps:{initFormRows:w,setFormState:n,serviceName:t,initAccount:v,initAwsIamRole:h},__self:void 0,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/utils/hookHelpers.js",lineNumber:304,columnNumber:9}}),document.getElementById("group_selection"))},f=500,p=9e3,m=Date.now(),function e(){document.querySelector(c)?_():setTimeout((function(){Date.now()-m>p||e()}),f)}()},Ne=function(e,t){var n=p("splunk_ta_aws_".concat(e),{app:N,sharing:"app"});return fetch("".concat(n,"?output_mode=json")).then((function(e){return e.json()})).then((function(e){if(Array.isArray(e.entry)&&e.entry.length){var n=e.entry.find((function(e){var n;return e.name===t.data.name.value&&(null==e||null===(n=e.content)||void 0===n?void 0:n._conflict_fields)}));if(n)return JSON.parse(n.content._conflict_fields)}return{}}))},Ee={distribution_id:function(e,t){t("log_name_format",e+j)},s3_file_decoder:function(e,t){t("sourcetype",F[e]),"AmazonSecurityLake"===e&&t("sqs_sns_validation",0)},metric_index_flag:function(e,t){t("sourcetype","1"===e?F.VPCFlowLogsMetric:F.VPCFlowLogs)}},qe=function(e){window.setAccount(e.data.aws_account.value)},Re=function(e){window.setAwsIamRole(e.data.aws_iam_role.value)},Fe={aws_config:function(e,t,n,a,r){"aws_account"===r&&qe(t)},splunk_ta_aws_sqs:function(e,t,n,a,r){"aws_account"===r&&qe(t),"aws_iam_role"===r&&Re(t)},aws_config_rule:function(e,t,n,a,r){"account"===r&&function(e){window.setAccount(e.data.account.value)}(t),"aws_iam_role"===r&&Re(t)},aws_kinesis:function(e,t,n,a,r){"account"===r&&function(e,t){e("region",t.data.region.value)}(n,a),["account","aws_iam_role","region","private_endpoint_enabled","sts_private_endpoint_url","kinesis_private_endpoint_url"].includes(r)&&function(e,t){e("stream_names",t.data.stream_names.value)}(n,a)},aws_cloudtrail_lake:function(e,t,n,a,r,s){var u=[];if("aws_account"===r&&u.push({key:"aws_region",value:a.data.aws_region.value,prop:"value"}),"aws_account"!==r&&"aws_iam_role"!==r&&"aws_region"!==r&&"private_endpoint_enabled"!==r&&"sts_private_endpoint_url"!==r&&"cloudtrail_private_endpoint_url"!==r||u.push({key:"event_data_store",value:a.data.event_data_store.value,prop:"value"}),"input_mode"===r)"index_once"===e?(u.push(we("end_date_time")),u.push(he("delay_throttle")),u.push(he("interval"))):(u.push(he("end_date_time")),u.push(we("delay_throttle")),u.push(we("interval")));else if("private_endpoint_enabled"===r){var o=e?we:he;["sts_private_endpoint_url","cloudtrail_private_endpoint_url"].forEach((function(e){return u.push(o(e))}))}s(u)}},je=function(e){var t=F.VPCFlowLogs;return"1"===e.data.metric_index_flag.value&&(t=F.VPCFlowLogsMetric),{key:"sourcetype",prop:"value",value:t}},Me={aws_billing:function(e){return e.data.initial_scan_datetime.value?[]:[{key:"initial_scan_datetime",prop:"value",value:y().utc().subtract(3,"months").startOf("month").format("YYYY-MM-DDTHH:mm:ss")+"Z"}]},aws_billing_cur:function(e){return e.data.start_date.value?[]:[{key:"start_date",prop:"value",value:y().utc().subtract(3,"months").startOf("month").format("YYYY-MM")}]},aws_s3:function(e,t){var n=[];return e.data.parse_csv_with_delimiter.value||n.push({key:"parse_csv_with_delimiter",prop:"value",value:","}),e.data.parse_csv_with_header.value||n.push({key:"parse_csv_with_header",prop:"value",value:0}),e.data.initial_scan_datetime.value||n.push({key:"initial_scan_datetime",prop:"value",value:y().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"}),"aws_cloudtrail"!==t&&n.push(he("ct_blacklist")),"others"!==t&&(["whitelist","blacklist"].forEach((function(e){return n.push(he(e))})),n.push(ge("sourcetype"))),n},aws_sqs_based_s3:function(e,t,n){var a=[];return"vpc_flow_logs"===t&&(a.push(we("metric_index_flag")),"edit"===n&&a.push(ge("metric_index_flag"))),e.data.metric_index_flag.value||a.push({key:"metric_index_flag",prop:"value",value:"0"}),e.data.sourcetype.value||a.push(function(e){return{key:"sourcetype",prop:"value",value:F[e.data.s3_file_decoder.value]}}(e)),e.data.parse_csv_with_delimiter.value||a.push({key:"parse_csv_with_delimiter",prop:"value",value:","}),e.data.parse_csv_with_header.value||a.push({key:"parse_csv_with_header",prop:"value",value:0}),e.data.private_endpoint_enabled.value||a.push({key:"private_endpoint_enabled",prop:"value",value:0}),"aws_asl"!==t&&"others"===t||["s3_file_decoder","sourcetype"].forEach((function(e){return a.push(ge(e))})),a},splunk_ta_aws_logs:function(e,t,n){var a=[];return"cloudfront_access_logs"===t&&(a.push(we("distribution_id")),"create"!==n&&(a.push(function(e){var t=e.data.log_name_format.value;return-1!==t.indexOf(j)&&(t=t.substring(0,t.length-j.length)),{key:"distribution_id",prop:"value",value:t}}(e)),"edit"===n&&a.push(ge("distribution_id")))),"aws_cloudtrail"===t&&(a.push(we("log_path_format")),"edit"===n&&a.push(ge("log_path_format"))),a.push(function(e){return{key:"sourcetype",prop:"value",value:M[e.data.log_type.value]}}(e)),a.push({key:"log_start_date",prop:"value",value:y().utc().subtract(7,"days").format("YYYY-MM-DD")}),["log_type","sourcetype"].forEach((function(e){return a.push(ge(e))})),a},aws_kinesis:function(e,t,n){var a=[];return"vpc_flow_logs"===t&&(["format","encoding","sourcetype"].forEach((function(e){return a.push(ge(e))})),a.push(we("metric_index_flag")),"edit"===n&&a.push(ge("metric_index_flag")),Array.isArray(e.data.sourcetype.value)&&a.push(je(e))),e.data.metric_index_flag.value||a.push({key:"metric_index_flag",prop:"value",value:"0"}),a},aws_cloudtrail_lake:function(e,t,n){var a,r=[],s=parseInt(e.data.private_endpoint_enabled.value)?we:he;return["cloudtrail_private_endpoint_url","sts_private_endpoint_url"].forEach((function(e){return r.push(s(e))})),"index_once"===e.data.input_mode.value?(r.push(we("end_date_time")),r.push(he("delay_throttle")),r.push(he("interval")),r.push({key:"interval",value:3600,prop:"value"})):(r.push(he("end_date_time")),r.push(we("delay_throttle"))),"create"===n&&r.push({key:"start_date_time",value:(a=new Date,a.setDate(a.getDate()-7),a.toISOString().substring(0,19)),prop:"value"}),r},aws_cloudwatch_logs:function(e,t,n){var a=[];return"vpc_flow_logs"===t&&(a.push(we("metric_index_flag")),"edit"===n&&a.push(ge("metric_index_flag")),Array.isArray(e.data.sourcetype.value)&&a.push(je(e))),e.data.metric_index_flag.value||a.push({key:"metric_index_flag",prop:"value",value:"0"}),e.data.query_window_size.value||a.push({key:"query_window_size",prop:"value",value:10}),a}},Le={splunk_ta_aws_logs:function(e,t,n){if("cloudfront:accesslogs"===e.log_type){if(null==e.log_name_format)return t.setErrorFieldMsg("distribution_id","Field Distribution ID is required."),!1;n("distribution_id",null)}return!0},aws_cloudwatch:function(e,t){if(null!=e&&e.period&&null!=e&&e.polling_interval){var n=e.polling_interval/e.period;if(Math.floor(n)!==n)return t.setErrorMsg('The number of "Polling Interval" field should be a multiple of "Granularity".'),!1}return!0},aws_s3:function(e,t){if(null!=e&&e.terminal_scan_datetime)try{if(y(e.terminal_scan_datetime)>y(L))return t.setErrorFieldMsg("terminal_scan_datetime","The max supported timestamp is 2038-01-19T03:14:07Z due to Year 2038 problem"),!1;t.clearAllErrorMsg()}catch(e){return!1}return!0},aws_sqs_based_s3:function(){var e=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.aws_account&&t.sqs_queue_region&&t.sqs_queue_url)){e.next=4;break}return e.next=3,ke(t,n.setErrorFieldMsg);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),aws_config_rule:function(e,t,n,a){var r,s=JSON.parse(a.data.rule_names.custom_errors),o=u(s.values());try{for(o.s();!(r=o.n()).done;){var i=r.value;if(null!==i&&""!==i)return t.setErrorMsg(i),!1}}catch(e){o.e(e)}finally{o.f()}return!0},aws_metadata:function(e,t){return!("apis"in e&&!e.apis.length)||t.setErrorMsg("Atleast one API must be selected.")},aws_cloudtrail_lake:function(e,t){if("index_once"===e.input_mode){if(!e.end_date_time)return t.setErrorFieldMsg("end_date_time","Field End date/time is required if the selected Input Mode is Index Once."),!1}else{if(e.interval<1)return t.setErrorFieldMsg("interval","Interval should be greater than 1 if the selected Input Mode is Continuously Monitor."),!1;if(!e.delay_throttle)return t.setErrorFieldMsg("delay_throttle","Field Delay Throttle (minutes) is required if the selected Input Mode is Continuously Monitor."),!1}return!0}},Oe=function(){function n(e,a,r,s,u){t(this,n),this.globalConfig=e,this.serviceName=a,this.state=r,this.mode=s,this.util=u,this.context=l(e,a),this.onEditLoad=this.onEditLoad.bind(this),this.updateState=this.updateState.bind(this),this._setValue=this._setValue.bind(this)}var r,c;return e(n,[{key:"onCreate",value:function(){var e=document.querySelector("button[label='Cancel']");e&&e.addEventListener("click",be)}},{key:"onChange",value:function(e,t,n){var a=Ee[e];"function"==typeof a&&a(t,this._setValue);var r=Fe[this.serviceName];"function"==typeof r&&r(t,n,this._setValue,this.state,e,this.updateState)}},{key:"onRender",value:function(){var e=ye(this.mode,this.state.data,this.serviceName),t=e.input,n=e.service;!function(e,t,n){if("edit"===e||"clone"===e){var a=window.location.toString().split("?"),r=new URL(a[0]);r.searchParams.set("service",n),r.searchParams.set("input",t),r.searchParams.set("action",e),window.history.replaceState({},"",r)}}(this.mode,t,n),function(e){var t=document.querySelector("form > div > div > span");if(t){var n=I(e);t.append(n)}}(n),O.includes(this.serviceName)&&xe(this.state,this.serviceName,this.util.setState,this.mode);var r=function(e,t){var n=[],a=S().find((function(n){return n.service===e&&n.input===t}));if(a){a.service,a.input;var r=s(a,ve);Object.keys(r).forEach((function(e){n.push({key:e,prop:"value",value:r[e]})}))}return n}(n,t);if(Me[this.serviceName]){var o,l=a({},this.state);if(r.length){var c,_=u(r);try{for(_.s();!(c=_.n()).done;){var d=c.value,f=d.key,p=d.prop,m=d.value;l.data[f][p]=m}}catch(e){_.e(e)}finally{_.f()}}r.push.apply(r,i(null===(o=Me[this.serviceName])||void 0===o?void 0:o.call(Me,l,t,this.mode)))}this.updateState(r)}},{key:"onSave",value:(c=o(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le[this.serviceName];case 2:if(!(n=e.sent)){e.next=6;break}return a=null==n?void 0:n(t,this.util,this._setValue,this.state),e.abrupt("return",a);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"onSaveSuccess",value:function(){be()}},{key:"onSaveFail",value:function(){if("splunk_ta_aws_logs"===this.serviceName&&"cloudfront:accesslogs"===this.state.data.log_type.value){var e=this.state.data.log_name_format.value;if(null!==e){var t=e.split(".")[0];this._setValue("distribution_id",t)}}}},{key:"onEditLoad",value:(r=o(regeneratorRuntime.mark((function e(){var t,n,a,r,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A.includes(this.serviceName)){e.next=6;break}return e.next=3,Ne(this.serviceName,this.state);case 3:t=e.sent,(n=Object.keys(t)).length&&(a=this.context.entity,r=n.map((function(e){"disabled"!==e&&u.util.setErrorFieldMsg(e,"");var n=a.find((function(t){return t.field===e})),r=n?n.label:e;return"".concat(r," = [").concat(t[e].join(", "),"]")})).join(", "),s="The following fields have conflict. ".concat(r,". Please resolve the conflict in conf file first."),this.util.setErrorMsg(s));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_setValue",value:function(e,t){this.util.setState((function(n){var r=a({},n.data);return r[e].value=t,{data:r}}))}},{key:"updateState",value:function(e){e.length&&this.util.setState((function(t){var n,r=a({},t.data),s=u(e);try{for(s.s();!(n=s.n()).done;){var o=n.value,i=o.key,l=o.prop,c=o.value;r[i][l]=c}}catch(e){s.e(e)}finally{s.f()}return{data:r}}))}}]),n}();export{Oe as default};
//# sourceMappingURL=Hook.js.map
