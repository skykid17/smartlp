var e={d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==a(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===a(r)?r:String(r)),n)}var r}e.d(t,{Z:()=>n});const n=function(){function e(t,a,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.globalConfig=t,this.serviceName=a,this.state=i,this.mode=n,this.util=r,this.handleStartDateField=this.handleStartDateField.bind(this),this.handleMetricField=this.handleMetricField.bind(this)}var t,a;return t=e,(a=[{key:"handleEditModeOnRender",value:function(e){var t="apps"===e.metric.value;return e.use_existing_checkpoint.display=!t,e.start_date.display=!t,e.use_existing_checkpoint.value="yes",e.use_existing_checkpoint.markdownMessage={text:"A Checkpoint for this input already exists. Selecting `No` will reset the data collection.",color:"red",markdownType:"text"},e.metric.disabled=!0,e.start_date.disabled=!0,e.end_date.disabled=!0,e}},{key:"onRender",value:function(){var e=this;this.util.setState((function(t){var a=JSON.parse(JSON.stringify(t.data));"edit"===e.mode&&(a=e.handleEditModeOnRender(a));var i="logs"===a.metric.value,n="apps"===a.metric.value;"create"===e.mode&&(a.start_date.value=i?e._getDefaultStartDate():e._getDefaultStartDateAppsMetric(),i||delete a.end_date.value),a.start_date.display=!n;var r=i||n;return a.advanced_settings.display=!1,r&&(a.advanced_settings.display=!0,a.advanced_settings.value=0,n&&(a.interval.value=86400)),{data:a}}))}},{key:"handleAdvancedSettingsField",value:function(e,t,a){var i=a.data.metric.value,n=0===parseInt(t);return e.logs_delay.display=!n&&"logs"===i,e.query_window_size.display=!n&&"logs"===i,e.end_date.display=!n&&"logs"===i,e.collect_uris.display=!n&&"apps"===i,e}},{key:"handleMetricField",value:function(e,t){var a="apps"===t,i="logs"===t;e.start_date.value=i?this._getDefaultStartDate():this._getDefaultStartDateAppsMetric(),e.start_date.display=!a,e.logs_delay.display=!1,e.query_window_size.display=!1,e.collect_uris.display=!1,delete e.end_date.value,e.end_date.display=!1;var n=i||a;return e.advanced_settings.display=!1,n&&(e.advanced_settings.value=0,e.advanced_settings.display=!0,a&&(e.interval.value=86400)),e}},{key:"handleUseExistingCheckpointField",value:function(e){var t=!("no"===e.use_existing_checkpoint.value);return e.start_date.disabled=t,e.end_date.disabled=t,e}},{key:"handleStartDateField",value:function(e,t){return"edit"!==(null==this?void 0:this.mode)||this.state.data.start_date.value!==t&&(e.start_date.markdownMessage={text:"Changing this parameter may result in gaps or duplication in data collection",color:"red",markdownType:"text"}),e}},{key:"_getDefaultStartDateAppsMetric",value:function(){return"1970-01-01T00:00:00.000Z"}},{key:"_getDefaultStartDate",value:function(){var e=new Date;return e.setDate(e.getDate()-7),e.toISOString()}},{key:"onChange",value:function(e,t,a){var i={advanced_settings:this.handleAdvancedSettingsField,metric:this.handleMetricField,use_existing_checkpoint:this.handleUseExistingCheckpointField,start_date:this.handleStartDateField}[e];"function"==typeof i&&this.util.setState((function(e){var n=JSON.parse(JSON.stringify(e.data));return{data:i(n,t,a)}}))}}])&&i(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();var r=t.Z;export{r as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c0IsTUFFRCxTQUFTMkMsRUFBV2pCLEVBQVVDLEdBQzVCLElBT01pQixFQVB1QixDQUMzQnBCLGtCQUFtQjdCLEtBQUtrRCw0QkFDeEIxQyxPQUFRUixLQUFLRyxrQkFDYk0sd0JBQXlCVCxLQUFLbUQsaUNBQzlCeEMsV0FBWVgsS0FBS0Msc0JBR3lCK0MsR0FDZCxtQkFBbkJDLEdBQ1RqRCxLQUFLRixLQUFLb0IsVUFBUyxTQUFDQyxHQUNsQixJQUFNaUMsRUFBZ0JoQyxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVSCxFQUFVYixPQUMxRCxNQUFPLENBQ0xBLEtBQU0yQyxFQUFlRyxFQUFlckIsRUFBVUMsR0FFbEQsR0FFSixNLG9FQUFDLEVBcEthLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9TcGx1bmtfVEFfb2t0YV9pZGVudGl0eV9jbG91ZC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9TcGx1bmtfVEFfb2t0YV9pZGVudGl0eV9jbG91ZC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vU3BsdW5rX1RBX29rdGFfaWRlbnRpdHlfY2xvdWQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9TcGx1bmtfVEFfb2t0YV9pZGVudGl0eV9jbG91ZC8uL3VjY191aV9leHRlbnNpb25zL2lucHV0c19ob29rLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLyoqXG4gKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyNCBTcGx1bmssIEluYy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBMaWNlbnNlUmVmLVNwbHVuay04LTIwMjFcbiAqXG4gKi9cblxuY2xhc3MgSW5wdXRzSG9vayB7XG4gIGNvbnN0cnVjdG9yKGdsb2JhbENvbmZpZywgc2VydmljZU5hbWUsIHN0YXRlLCBtb2RlLCB1dGlsKSB7XG4gICAgdGhpcy5nbG9iYWxDb25maWcgPSBnbG9iYWxDb25maWc7XG4gICAgdGhpcy5zZXJ2aWNlTmFtZSA9IHNlcnZpY2VOYW1lO1xuICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgIHRoaXMudXRpbCA9IHV0aWw7XG4gICAgdGhpcy5oYW5kbGVTdGFydERhdGVGaWVsZCA9IHRoaXMuaGFuZGxlU3RhcnREYXRlRmllbGQuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZU1ldHJpY0ZpZWxkID0gdGhpcy5oYW5kbGVNZXRyaWNGaWVsZC5iaW5kKHRoaXMpO1xuICB9XG5cbiAgaGFuZGxlRWRpdE1vZGVPblJlbmRlcihkYXRhKSB7XG4gICAgY29uc3QgaXNNZXRyaWNBcHBzID0gZGF0YS5tZXRyaWMudmFsdWUgPT09IFwiYXBwc1wiO1xuXG4gICAgZGF0YS51c2VfZXhpc3RpbmdfY2hlY2twb2ludC5kaXNwbGF5ID0gIWlzTWV0cmljQXBwcztcbiAgICBkYXRhLnN0YXJ0X2RhdGUuZGlzcGxheSA9ICFpc01ldHJpY0FwcHM7XG5cbiAgICBkYXRhLnVzZV9leGlzdGluZ19jaGVja3BvaW50LnZhbHVlID0gXCJ5ZXNcIjtcbiAgICBkYXRhLnVzZV9leGlzdGluZ19jaGVja3BvaW50Lm1hcmtkb3duTWVzc2FnZSA9IHtcbiAgICAgIHRleHQ6IFwiQSBDaGVja3BvaW50IGZvciB0aGlzIGlucHV0IGFscmVhZHkgZXhpc3RzLiBTZWxlY3RpbmcgYE5vYCB3aWxsIHJlc2V0IHRoZSBkYXRhIGNvbGxlY3Rpb24uXCIsXG4gICAgICBjb2xvcjogXCJyZWRcIixcbiAgICAgIG1hcmtkb3duVHlwZTogXCJ0ZXh0XCIsXG4gICAgfTtcblxuICAgIGRhdGEubWV0cmljLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBkYXRhLnN0YXJ0X2RhdGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGRhdGEuZW5kX2RhdGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgb25SZW5kZXIoKSB7XG4gICAgdGhpcy51dGlsLnNldFN0YXRlKChwcmV2U3RhdGUpID0+IHtcbiAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwcmV2U3RhdGUuZGF0YSkpO1xuXG4gICAgICBpZiAodGhpcy5tb2RlID09PSBcImVkaXRcIikge1xuICAgICAgICBkYXRhID0gdGhpcy5oYW5kbGVFZGl0TW9kZU9uUmVuZGVyKGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpc01ldHJpY0xvZ3MgPSBkYXRhLm1ldHJpYy52YWx1ZSA9PT0gXCJsb2dzXCI7XG4gICAgICBjb25zdCBpc01ldHJpY0FwcHMgPSBkYXRhLm1ldHJpYy52YWx1ZSA9PT0gXCJhcHBzXCI7XG5cbiAgICAgIGlmICh0aGlzLm1vZGUgPT09IFwiY3JlYXRlXCIpIHtcbiAgICAgICAgaWYgKGlzTWV0cmljTG9ncykge1xuICAgICAgICAgIGRhdGEuc3RhcnRfZGF0ZS52YWx1ZSA9IHRoaXMuX2dldERlZmF1bHRTdGFydERhdGUoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRhdGEuc3RhcnRfZGF0ZS52YWx1ZSA9IHRoaXMuX2dldERlZmF1bHRTdGFydERhdGVBcHBzTWV0cmljKClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNNZXRyaWNMb2dzKSB7XG4gICAgICAgICAgZGVsZXRlIGRhdGEuZW5kX2RhdGUudmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgZGF0YS5zdGFydF9kYXRlLmRpc3BsYXkgPSAhaXNNZXRyaWNBcHBzO1xuXG4gICAgICBjb25zdCBpc0FkdmFuY2VkU2V0dGluZ3NSZXF1aXJlZCA9IGlzTWV0cmljTG9ncyB8fCBpc01ldHJpY0FwcHM7XG4gICAgICBkYXRhLmFkdmFuY2VkX3NldHRpbmdzLmRpc3BsYXkgPSBmYWxzZTtcbiAgICAgIGlmIChpc0FkdmFuY2VkU2V0dGluZ3NSZXF1aXJlZCkge1xuICAgICAgICBkYXRhLmFkdmFuY2VkX3NldHRpbmdzLmRpc3BsYXkgPSB0cnVlO1xuICAgICAgICBkYXRhLmFkdmFuY2VkX3NldHRpbmdzLnZhbHVlID0gMDtcbiAgICAgICAgaWYgKGlzTWV0cmljQXBwcykge1xuICAgICAgICAgIGRhdGEuaW50ZXJ2YWwudmFsdWUgPSA4NjQwMDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXRhLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZUFkdmFuY2VkU2V0dGluZ3NGaWVsZChkYXRhLCBvbGRWYWx1ZSwgZGF0YURpY3QpIHtcbiAgICBjb25zdCBjdXJyZW50TWV0cmljID0gZGF0YURpY3QuZGF0YS5tZXRyaWMudmFsdWU7XG4gICAgY29uc3Qgd2FzWmVybyA9IHBhcnNlSW50KG9sZFZhbHVlKSA9PT0gMDtcblxuICAgIGRhdGEubG9nc19kZWxheS5kaXNwbGF5ID0gIXdhc1plcm8gJiYgY3VycmVudE1ldHJpYyA9PT0gXCJsb2dzXCI7XG4gICAgZGF0YS5xdWVyeV93aW5kb3dfc2l6ZS5kaXNwbGF5ID0gIXdhc1plcm8gJiYgY3VycmVudE1ldHJpYyA9PT0gXCJsb2dzXCI7XG4gICAgZGF0YS5lbmRfZGF0ZS5kaXNwbGF5ID0gIXdhc1plcm8gJiYgY3VycmVudE1ldHJpYyA9PT0gXCJsb2dzXCI7XG4gICAgZGF0YS5jb2xsZWN0X3VyaXMuZGlzcGxheSA9ICF3YXNaZXJvICYmIGN1cnJlbnRNZXRyaWMgPT09IFwiYXBwc1wiO1xuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBoYW5kbGVNZXRyaWNGaWVsZChkYXRhLCBvbGRWYWx1ZSkge1xuICAgIGNvbnN0IGlzQXBwcyA9IG9sZFZhbHVlID09PSBcImFwcHNcIjtcbiAgICBjb25zdCBpc0xvZ3MgPSBvbGRWYWx1ZSA9PT0gXCJsb2dzXCI7XG5cbiAgICBpZiAoaXNMb2dzKSB7XG4gICAgICBkYXRhLnN0YXJ0X2RhdGUudmFsdWUgPSB0aGlzLl9nZXREZWZhdWx0U3RhcnREYXRlKClcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVE9ETyAtIHJlbW92ZSB0aGUgZGVwZW5kZW5jeSBvZiBzdGFydF9kYXRlIGZvciBhcHBzIG1ldHJpY1xuICAgICAgZGF0YS5zdGFydF9kYXRlLnZhbHVlID0gdGhpcy5fZ2V0RGVmYXVsdFN0YXJ0RGF0ZUFwcHNNZXRyaWMoKVxuICAgIH1cblxuICAgIGRhdGEuc3RhcnRfZGF0ZS5kaXNwbGF5ID0gIWlzQXBwcztcbiAgICBkYXRhLmxvZ3NfZGVsYXkuZGlzcGxheSA9IGZhbHNlO1xuICAgIGRhdGEucXVlcnlfd2luZG93X3NpemUuZGlzcGxheSA9IGZhbHNlO1xuICAgIGRhdGEuY29sbGVjdF91cmlzLmRpc3BsYXkgPSBmYWxzZTtcbiAgICBkZWxldGUgZGF0YS5lbmRfZGF0ZS52YWx1ZTtcbiAgICBkYXRhLmVuZF9kYXRlLmRpc3BsYXkgPSBmYWxzZTtcblxuICAgIGNvbnN0IGlzQWR2YW5jZWRTZXR0aW5nc1JlcXVpcmVkID0gaXNMb2dzIHx8IGlzQXBwcztcbiAgICBkYXRhLmFkdmFuY2VkX3NldHRpbmdzLmRpc3BsYXkgPSBmYWxzZTtcbiAgICBpZiAoaXNBZHZhbmNlZFNldHRpbmdzUmVxdWlyZWQpIHtcbiAgICAgIGRhdGEuYWR2YW5jZWRfc2V0dGluZ3MudmFsdWUgPSAwO1xuICAgICAgZGF0YS5hZHZhbmNlZF9zZXR0aW5ncy5kaXNwbGF5ID0gdHJ1ZTtcbiAgICAgIGlmIChpc0FwcHMpIHtcbiAgICAgICAgZGF0YS5pbnRlcnZhbC52YWx1ZSA9IDg2NDAwO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgaGFuZGxlVXNlRXhpc3RpbmdDaGVja3BvaW50RmllbGQoZGF0YSkge1xuICAgIGNvbnN0IGRpc2FibGVEYXRlcyA9ICEoZGF0YS51c2VfZXhpc3RpbmdfY2hlY2twb2ludC52YWx1ZSA9PT0gXCJub1wiKTtcbiAgICBkYXRhLnN0YXJ0X2RhdGUuZGlzYWJsZWQgPSBkaXNhYmxlRGF0ZXM7XG4gICAgZGF0YS5lbmRfZGF0ZS5kaXNhYmxlZCA9IGRpc2FibGVEYXRlcztcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGhhbmRsZVN0YXJ0RGF0ZUZpZWxkKGRhdGEsIGN1cnJlbnRWYWx1ZSkge1xuICAgIGlmICh0aGlzPy5tb2RlICE9PSBcImVkaXRcIikge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIGNvbnN0IG9sZFN0YXJ0RGF0ZSA9IHRoaXMuc3RhdGUuZGF0YS5zdGFydF9kYXRlLnZhbHVlO1xuXG4gICAgaWYgKG9sZFN0YXJ0RGF0ZSAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICBkYXRhLnN0YXJ0X2RhdGUubWFya2Rvd25NZXNzYWdlID0ge1xuICAgICAgICB0ZXh0OiBcIkNoYW5naW5nIHRoaXMgcGFyYW1ldGVyIG1heSByZXN1bHQgaW4gZ2FwcyBvciBkdXBsaWNhdGlvbiBpbiBkYXRhIGNvbGxlY3Rpb25cIixcbiAgICAgICAgY29sb3I6IFwicmVkXCIsXG4gICAgICAgIG1hcmtkb3duVHlwZTogXCJ0ZXh0XCIsXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIF9nZXREZWZhdWx0U3RhcnREYXRlQXBwc01ldHJpYygpIHtcbiAgICByZXR1cm4gXCIxOTcwLTAxLTAxVDAwOjAwOjAwLjAwMFpcIlxuICB9XG5cbiAgX2dldERlZmF1bHRTdGFydERhdGUoKSB7XG4gICAgbGV0IGRlZmF1bHREYXRlID0gbmV3IERhdGUoKTtcbiAgICBkZWZhdWx0RGF0ZS5zZXREYXRlKGRlZmF1bHREYXRlLmdldERhdGUoKSAtIDcpOyAvLyBTdWJ0cmFjdCA3IGRheXNcbiAgICByZXR1cm4gZGVmYXVsdERhdGUudG9JU09TdHJpbmcoKVxuICB9XG5cbiAgb25DaGFuZ2UoZmllbGROYW1lLCBvbGRWYWx1ZSwgZGF0YURpY3QpIHtcbiAgICBjb25zdCBhZGp1c3REYXRhRnVuY01hcHBlciA9IHtcbiAgICAgIGFkdmFuY2VkX3NldHRpbmdzOiB0aGlzLmhhbmRsZUFkdmFuY2VkU2V0dGluZ3NGaWVsZCxcbiAgICAgIG1ldHJpYzogdGhpcy5oYW5kbGVNZXRyaWNGaWVsZCxcbiAgICAgIHVzZV9leGlzdGluZ19jaGVja3BvaW50OiB0aGlzLmhhbmRsZVVzZUV4aXN0aW5nQ2hlY2twb2ludEZpZWxkLFxuICAgICAgc3RhcnRfZGF0ZTogdGhpcy5oYW5kbGVTdGFydERhdGVGaWVsZCxcbiAgICB9O1xuXG4gICAgY29uc3QgYWRqdXN0RGF0YUZ1bmMgPSBhZGp1c3REYXRhRnVuY01hcHBlcltmaWVsZE5hbWVdO1xuICAgIGlmICh0eXBlb2YgYWRqdXN0RGF0YUZ1bmMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhpcy51dGlsLnNldFN0YXRlKChwcmV2U3RhdGUpID0+IHtcbiAgICAgICAgY29uc3QgZGVlcFN0YXRlQ29weSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocHJldlN0YXRlLmRhdGEpKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IGFkanVzdERhdGFGdW5jKGRlZXBTdGF0ZUNvcHksIG9sZFZhbHVlLCBkYXRhRGljdCksXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSW5wdXRzSG9vaztcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImdsb2JhbENvbmZpZyIsInNlcnZpY2VOYW1lIiwic3RhdGUiLCJtb2RlIiwidXRpbCIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJoYW5kbGVTdGFydERhdGVGaWVsZCIsImJpbmQiLCJoYW5kbGVNZXRyaWNGaWVsZCIsIl9jcmVhdGVDbGFzcyIsInZhbHVlIiwiZGF0YSIsImlzTWV0cmljQXBwcyIsIm1ldHJpYyIsInVzZV9leGlzdGluZ19jaGVja3BvaW50IiwiZGlzcGxheSIsInN0YXJ0X2RhdGUiLCJtYXJrZG93bk1lc3NhZ2UiLCJ0ZXh0IiwiY29sb3IiLCJtYXJrZG93blR5cGUiLCJkaXNhYmxlZCIsImVuZF9kYXRlIiwic2V0U3RhdGUiLCJwcmV2U3RhdGUiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJfdGhpcyIsImhhbmRsZUVkaXRNb2RlT25SZW5kZXIiLCJpc01ldHJpY0xvZ3MiLCJfZ2V0RGVmYXVsdFN0YXJ0RGF0ZSIsIl9nZXREZWZhdWx0U3RhcnREYXRlQXBwc01ldHJpYyIsImlzQWR2YW5jZWRTZXR0aW5nc1JlcXVpcmVkIiwiYWR2YW5jZWRfc2V0dGluZ3MiLCJpbnRlcnZhbCIsIm9sZFZhbHVlIiwiZGF0YURpY3QiLCJjdXJyZW50TWV0cmljIiwid2FzWmVybyIsInBhcnNlSW50IiwibG9nc19kZWxheSIsInF1ZXJ5X3dpbmRvd19zaXplIiwiY29sbGVjdF91cmlzIiwiaXNBcHBzIiwiaXNMb2dzIiwiZGlzYWJsZURhdGVzIiwiY3VycmVudFZhbHVlIiwiZGVmYXVsdERhdGUiLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJ0b0lTT1N0cmluZyIsImZpZWxkTmFtZSIsImFkanVzdERhdGFGdW5jIiwiaGFuZGxlQWR2YW5jZWRTZXR0aW5nc0ZpZWxkIiwiaGFuZGxlVXNlRXhpc3RpbmdDaGVja3BvaW50RmllbGQiLCJkZWVwU3RhdGVDb3B5Il0sInNvdXJjZVJvb3QiOiIifQ==